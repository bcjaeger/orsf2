
# Examples

`orsf()` is the entry-point of the `aorsf` package. It can be used to fit classification, regression, and survival forests. It can also compute out-of-bag prediction accuracy or out-of-bag variable importance using built-in functions or custom functions supplied by users.  

```{r, echo=FALSE}
knitr::opts_chunk$set(cache = TRUE)
```

First we load some relevant packages

```{r, message=FALSE, warning=FALSE}

set.seed(329730)
library(aorsf)
library(tidyverse)
library(survival)

```


## Classification

We'll use the outstanding `penguin` data for this example:

```{r}

# penguins_orsf is a copy of the penguins data
# from palmerpenguins but only includes complete cases:
head(penguins_orsf)

```

The `orsf()` function will automatically fit a classification forest if the outcome variable is a factor:

```{r}

fit_penguins <- orsf(data = penguins_orsf,
                     formula = species ~ bill_length_mm + flipper_length_mm)

fit_penguins

```

You can also tell `orsf()` to do classification manually if you'd prefer keeping a numeric outcome. The way to do this is through the `control` argument:

```{r}

penguins_numeric <- penguins_orsf
penguins_numeric$species <- as.numeric(penguins_numeric$species)

fit_numeric <- orsf(penguins_numeric,
                    formula = species ~ bill_length_mm + flipper_length_mm,
                    control = orsf_control_classification())

fit_numeric

```

You could also use `orsf_update` to make `fit_numeric` simply by giving it a new `data` argument

```{r}

orsf_update(fit_penguins, data = penguins_numeric)

```

## Regression



## Survival

```{r}

fit <- orsf(pbc_orsf, Surv(time, status) ~ . - id)

```

printing `fit` provides quick descriptive summaries:

```{r}
fit
```


## More than one way to grow a forest

You can use `orsf(no_fit = TRUE)` to make a specification to grow a forest that can be used as a blueprint for `orsf_train()`:

```{r}

orsf_spec <- orsf(pbc_orsf, time + status ~ . - id, no_fit = TRUE)
orsf_spec

```


```{r}

orsf_fit <- orsf_train(orsf_spec)
orsf_fit

```

You can also update the specification in place when passing it to `orsf_train()`, making it easy to fit several models from one spec:

```{r}

orsf_fit_10 <- orsf_train(orsf_spec, leaf_min_obs = 10)
orsf_fit_20 <- orsf_train(orsf_spec, leaf_min_obs = 20)

orsf_fit$leaf_min_obs
orsf_fit_10$leaf_min_obs
orsf_fit_20$leaf_min_obs

```

## tidymodels

`tidymodels` includes support for `aorsf` as a computational engine:

```{r, warning=FALSE, echo=TRUE, message=FALSE}

library(tidymodels)
library(censored)
library(yardstick)

pbc_tidy <- pbc_orsf %>% 
 mutate(event_time = Surv(time, status), .before = 1) %>% 
 select(-c(id, time, status)) %>% 
 as_tibble()

split  <- initial_split(pbc_tidy)

orsf_spec <- rand_forest() %>% 
 set_engine("aorsf") %>% 
 set_mode("censored regression")

orsf_fit <- fit(orsf_spec, event_time ~ ., data = training(split))

```

Prediction with `aorsf` models at different times is also supported:

```{r}

time_points <- seq(500, 3000, by = 500)

test_pred <- augment(orsf_fit, 
                     new_data = testing(split), 
                     eval_time = time_points)

brier_scores <- test_pred %>% 
  brier_survival(truth = event_time, .pred)

brier_scores

roc_scores <- test_pred %>% 
  roc_auc_survival(truth = event_time, .pred)

roc_scores

```


