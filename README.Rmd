---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

#' @srrstats {G1.2} *Project status describes current and anticipated future states of development.* 
 
```

# aorsf <a href="https://bcjaeger.github.io/aorsf"><img src="man/figures/logo.png" align="right" height="138" /></a>




<!-- badges: start -->
[![Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
  [![Codecov test coverage](https://codecov.io/gh/bcjaeger/aorsf/branch/master/graph/badge.svg)](https://app.codecov.io/gh/bcjaeger/aorsf?branch=master)
[![R-CMD-check](https://github.com/bcjaeger/aorsf/workflows/R-CMD-check/badge.svg)](https://github.com/bcjaeger/aorsf/actions)
[![Status at rOpenSci Software Peer Review](https://badges.ropensci.org/532_status.svg)](https://github.com/ropensci/software-review/issues/532)
<!-- badges: end -->

`aorsf` provides optimized software to fit, interpret, and make predictions with oblique random survival forests (ORSFs).  


## Why aorsf?

- Hundreds of times faster than `obliqueRSF`.^1^

- Fast and accurate predictions for censored outcomes.^2^

- negation importance, a novel technique to estimate variable importance for ORSFs.^2^

- intuitive API with formula based interface.

- extensive input checks + informative error messages.

## Installation

You can install the development version of aorsf from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("bcjaeger/aorsf")
```

## What is an oblique decision tree?

Decision trees are developed by splitting a set of training data into two new subsets, with the goal of having more similarity within the new subsets than between them. The splitting process is repeated on resulting subsets of data until a stopping criterion is met. 

When the new subsets of data are formed based on a single predictor, the decision tree is said to be *axis-based* because the splits of the data appear perpendicular to the axis of the predictor. When linear combinations of variables are used instead of a single variable, the tree is *oblique* because the splits of the data are neither parallel nor at a right angle to the axis. 

**Figure**: Decision trees for classification with axis-based splitting (left) and oblique splitting (right). Cases are orange squares; controls are purple circles. Both trees partition the predictor space defined by variables X1 and X2, but the oblique splits do a better job of separating the two classes.

```{r fig_oblique_v_axis, out.width='100%', echo = FALSE}

knitr::include_graphics('man/figures/tree_axis_v_oblique.png')

```

## Examples

The `orsf()` function can fit several types of ORSF ensembles. My personal favorite is the accelerated ORSF because it has a great combination of prediction accuracy and computational efficiency (see [arXiv paper](https://arxiv.org/abs/2208.01129)).^2^

```{r, child='Rmd/orsf-fit-accelerated.Rmd'}

```

ORSF CONTROL VIGNETTE (not yet written). 

### Inspect

Printing the output from `orsf()` will give some information and descriptive statistics about the ensemble.

```{r}

fit

```

See [`print.orsf_fit`](https://bcjaeger.github.io/aorsf/reference/print.orsf_fit.html) for a description of each line in the printed output.

### Variable importance

The importance of individual variables can be estimated in three ways using `aorsf`:

- **negation**^2^: `r aorsf:::roxy_vi_describe('negate')`

  ```{r}
  
  orsf_vi_negate(fit)
  
  ```

- **permutation**: `r aorsf:::roxy_vi_describe('permute')`

  ```{r}
  
  orsf_vi_permute(fit)
  
  ```
  
- **analysis of variance (ANOVA)**^3^: `r aorsf:::roxy_vi_describe('anova')`

  ```{r}
  
  orsf_vi_anova(fit)
  
  ```

You can supply your own R function to estimate out-of-bag error when using negation or permutation importance (see [oob vignette](https://bcjaeger.github.io/aorsf/articles/oobag.html)). 

### Predict



### Partial dependence

`aorsf` can generate individual conditional expectation (ICE) and partial dependence (PD): 

- ICE shows how the predicted value for an observation changes when a predictor changes. `orsf_ice()`, the function to compute ICE values in `aorsf`, returns ICE for all observations in the data you supply it. (If no data are supplied, the ORSF's training data are used)

  ```{r}
  
  # ICE values:
  # predicted risk for a single observation with respect to bili.
  
  orsf_ice_oob(fit, pred_spec = list(bili = c(1:5)))[id_row == 2]
  
  ```

- PD shows how the **expected** predicted value changes when a predictor changes. PD estimates the relationship between the model's prediction and a predictor, adjusting for other predictors.

  ```{r}
  
  orsf_pd_oob(fit, pred_spec = list(bili = c(1:5)))
  
  ```


- use `orsf_summarize_uni()` to show the top predictor variables in an ORSF model and the expected predicted risk at specific values of those predictors. (The term 'uni' is short for univariate.)

  ```{r}

  # take a look at the top 5 variables 
  # for continuous predictors, see expected risk at 25/50/75th quantile
  # for categorical predictors, see expected risk in specified category

  orsf_summarize_uni(object = fit, n_variables = 5)

  ```

## Comparison to existing software

Jaeger (2022) describes `aorsf` in detail, with a summary of the procedures used in the tree fitting algorithm and a general benchmark comparing `aorsf` with `obliqueRSF` (and several other learners) in terms of prediction accuracy and computational efficiency. 



## References

```{r results='asis', echo=FALSE}

cat("1. ", aorsf:::roxy_cite_jaeger_2019(), '\n\n')

cat("2. ", aorsf:::roxy_cite_jaeger_2022(), '\n\n')

cat("3. ", aorsf:::roxy_cite_menze_2011())

```


## Funding

The developers of `aorsf` receive financial support from the Center for Biomedical Informatics, Wake Forest University School of Medicine. We also receive support from the National Center for Advancing Translational Sciences of the National Institutes of Health under Award Number UL1TR001420. 

The content is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health.

