<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimate the importance of individual predictor variables using
oblique random forests."><title>Variable Importance — orsf_vi • aorsf</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variable Importance — orsf_vi"><meta property="og:description" content="Estimate the importance of individual predictor variables using
oblique random forests."><meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/aorsf.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pd.html">PD and ICE curves with ORSF</a>
    <a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a>
    <a class="dropdown-item" href="../articles/fast.html">Tips to speed up computation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/aorsf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Variable Importance</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/aorsf/blob/HEAD/R/orsf_vi.R" class="external-link"><code>R/orsf_vi.R</code></a></small>
      <div class="d-none name"><code>orsf_vi.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimate the importance of individual predictor variables using
oblique random forests.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orsf_vi</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  group_factors <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  importance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  oobag_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_vi_negate</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  group_factors <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  oobag_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_vi_permute</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  group_factors <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  oobag_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_vi_anova</span><span class="op">(</span><span class="va">object</span>, group_factors <span class="op">=</span> <span class="cn">TRUE</span>, verbose_progress <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>(<em>ObliqueForest</em>) a trained oblique random forest object (see <a href="orsf.html">orsf</a>).</p></dd>


<dt>group_factors</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, the importance of factor variables will be reported overall by aggregating the importance of individual levels of the factor. If <code>FALSE</code>, the importance of individual factor levels will be returned.</p></dd>


<dt>importance</dt>
<dd><p>(<em>character</em>) Indicate method for variable importance:</p><ul><li><p>'anova': compute analysis of variance (ANOVA) importance</p></li>
<li><p>'negate': compute negation importance</p></li>
<li><p>'permute': compute permutation importance</p></li>
</ul></dd>


<dt>oobag_fun</dt>
<dd><p>(<em>function</em>) to be used for evaluating out-of-bag prediction accuracy after negating coefficients
(if importance = 'negate') or permuting the values of a predictor
(if importance = 'permute')</p><ul><li><p>When <code>oobag_fun = NULL</code> (the default), the evaluation statistic is selected based on tree type</p></li>
<li><p>survival: Harrell's C-statistic (1982)</p></li>
<li><p>classification: Area underneath the ROC curve (AUC-ROC)</p></li>
<li><p>regression: Traditional prediction R-squared</p></li>
<li><p>if you use your own <code>oobag_fun</code> note the following:</p><ul><li><p><code>oobag_fun</code> should have three inputs: <code>y_mat</code>, <code>w_vec</code>, and <code>s_vec</code></p></li>
<li><p>For survival trees, <code>y_mat</code> should be a two column matrix with first column named 'time' and second named 'status'. For classification trees, <code>y_mat</code> should be a matrix with number of columns = number of distinct classes in the outcome. For regression, <code>y_mat</code> should be a matrix with one column.</p></li>
<li><p><code>s_vec</code> is a numeric vector containing predictions</p></li>
<li><p><code>oobag_fun</code> should return a numeric output of length 1</p></li>
<li><p>the same <code>oobag_fun</code> should have been used when you created <code>object</code>
so that the initial value of out-of-bag prediction accuracy is
consistent with the values that will be computed while variable
importance is estimated.</p></li>
</ul></li>
</ul><p>For more details, see the out-of-bag
<a href="https://docs.ropensci.org/aorsf/articles/oobag.html" class="external-link">vignette</a>.</p></dd>


<dt>n_thread</dt>
<dd><p>(<em>integer</em>) number of threads to use while computing predictions. Default is 0, which allows a suitable number of threads to be used based on availability.</p></dd>


<dt>verbose_progress</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, progress messages are
printed in the console. If <code>FALSE</code> (the default), nothing is printed.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed to or from other methods (not currently used).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>orsf_vi</code> functions return a named numeric vector.</p><ul><li><p>Names of the vector are the predictor variables used by <code>object</code></p></li>
<li><p>Values of the vector are the estimated importance of the given predictor.</p></li>
</ul><p>The returned vector is sorted from highest to lowest value, with higher
values indicating higher importance.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When an <code>ObliqueForest</code> object is grown with importance = 'anova',
'negate', or 'permute', the output will have a vector of importance
values based on the requested type of importance. However, <code>orsf_vi()</code>
can be used to compute variable importance after growing a forest
or to compute a different type of importance.</p>
<p><code>orsf_vi()</code> is a general purpose function to extract or compute variable
importance estimates from an <code>ObliqueForest</code> object (see <a href="orsf.html">orsf</a>).
<code>orsf_vi_negate()</code>, <code>orsf_vi_permute()</code>, and <code>orsf_vi_anova()</code> are wrappers
for <code>orsf_vi()</code>. The way these functions work depends on whether the
<code>object</code> they are given already has variable importance estimates in it
or not (see examples).</p>
    </div>
    <div class="section level2">
    <h2 id="variable-importance-methods">Variable importance methods<a class="anchor" aria-label="anchor" href="#variable-importance-methods"></a></h2>
    


<p><strong>negation importance</strong>: Each variable is assessed separately by multiplying the variable's coefficients by -1 and then determining how much the model's performance changes. The worse the model's performance after negating coefficients for a given variable, the more important the variable. This technique is promising b/c it does not require permutation and it emphasizes variables with larger coefficients in linear combinations, but it is also relatively new and hasn't been studied as much as permutation importance. See Jaeger, (2023) for more details on this technique.</p>
<p><strong>permutation importance</strong>: Each variable is assessed separately by randomly permuting the variable's values and then determining how much the model's performance changes. The worse the model's performance after permuting the values of a given variable, the more important the variable. This technique is flexible, intuitive, and frequently used. It also has several <a href="https://christophm.github.io/interpretable-ml-book/feature-importance.html#disadvantages-9" class="external-link">known limitations</a></p>
<p><strong>analysis of variance (ANOVA) importance</strong>: A p-value is computed for each coefficient in each linear combination of variables in each decision tree. Importance for an individual predictor variable is the proportion of times a p-value for its coefficient is &lt; 0.01. This technique is very efficient computationally, but may not be as effective as permutation or negation in terms of selecting signal over noise variables. See <a href="https://link.springer.com/chapter/10.1007/978-3-642-23783-6_29" class="external-link">Menze, 2011</a> for more details on this technique.</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
    
<div class="section">
<h3 id="anova-importance">ANOVA importance<a class="anchor" aria-label="anchor" href="#anova-importance"></a></h3>


<p>The default variable importance technique, ANOVA, is calculated while
you fit an oblique random forest ensemble.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------- Oblique random survival forest</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      Linear combinations: Accelerated Cox regression</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##           N observations: 276</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##                 N events: 111</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                  N trees: 500</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">##       N predictors total: 17</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    N predictors per node: 5</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  Average leaves per tree: 21.022</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Min observations in leaf: 5</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">##       Min events in leaf: 1</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="do">##           OOB stat value: 0.84</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">##            OOB stat type: Harrell's C-index</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">##      Variable importance: anova</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## -----------------------------------------</span></span></code></pre><p></p></div>
<p>ANOVA is the default because it is fast, but it may not be as decisive
as the permutation and negation techniques for variable selection.</p>
</div>

<div class="section">
<h3 id="raw-vi-values">Raw VI values<a class="anchor" aria-label="anchor" href="#raw-vi-values"></a></h3>


<p>the ‘raw’ variable importance values can be accessed from the fit object</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit</span><span class="op">$</span><span class="fu">get_importance_raw</span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                   [,1]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## trt_placebo 0.06355042</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## age         0.23259259</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## sex_f       0.14700432</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ascites_1   0.46791708</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## hepato_1    0.14349776</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## spiders_1   0.17371938</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## edema_0.5   0.17459191</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">## edema_1     0.51197605</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">## bili        0.40590758</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">## chol        0.17666667</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="do">## albumin     0.25972156</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">## copper      0.28840580</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## alk.phos    0.10614251</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ast         0.18327491</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## trig        0.12815626</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="do">## platelet    0.09265648</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## protime     0.22656250</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="do">## stage       0.20264766</span></span></code></pre><p></p></div>
<p>these are ‘raw’ because values for factors have not been aggregated into
a single value. Currently there is one value for k-1 levels of a k level
factor. For example, you can see edema_1 and edema_0.5 in the importance
values above because edema is a factor variable with levels of 0, 0.5,
and 1.</p>
</div>

<div class="section">
<h3 id="collapse-vi-across-factor-levels">Collapse VI across factor levels<a class="anchor" aria-label="anchor" href="#collapse-vi-across-factor-levels"></a></h3>


<p>To get aggregated values across all levels of each factor,</p><ul><li><p>access the <code>importance</code> element from the <code>orsf</code> fit:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># this assumes you used group_factors = TRUE in orsf()</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">importance</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    ascites       bili      edema     copper    albumin        age    protime </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.46791708 0.40590758 0.31115216 0.28840580 0.25972156 0.23259259 0.22656250 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      stage        ast       chol    spiders        sex     hepato       trig </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.20264766 0.18327491 0.17666667 0.17371938 0.14700432 0.14349776 0.12815626 </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   alk.phos   platelet        trt </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.10614251 0.09265648 0.06355042</span></span></code></pre><p></p></div></li>
<li><p>use <code>orsf_vi()</code> with group_factors set to <code>TRUE</code> (the default)</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/orsf_vi.html">orsf_vi</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    ascites       bili      edema     copper    albumin        age    protime </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.46791708 0.40590758 0.31115216 0.28840580 0.25972156 0.23259259 0.22656250 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      stage        ast       chol    spiders        sex     hepato       trig </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.20264766 0.18327491 0.17666667 0.17371938 0.14700432 0.14349776 0.12815626 </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   alk.phos   platelet        trt </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.10614251 0.09265648 0.06355042</span></span></code></pre><p></p></div></li>
</ul><p>Note that you can make the default returned importance values ungrouped
by setting <code>group_factors</code> to <code>FALSE</code> in the <code>orsf_vi</code> functions or the
<code>orsf</code> function.</p>
</div>

<div class="section">
<h3 id="add-vi-to-an-oblique-random-forest">Add VI to an oblique random forest<a class="anchor" aria-label="anchor" href="#add-vi-to-an-oblique-random-forest"></a></h3>


<p>You can fit an oblique random forest without VI, then add VI later</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_no_vi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                  importance <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note: you can't call orsf_vi_anova() on fit_no_vi because anova</span></span>
<span><span class="co"># VI can only be computed while the forest is being grown.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/orsf_vi.html">orsf_vi_negate</a></span><span class="op">(</span><span class="va">fit_no_vi</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##        bili      copper         sex     protime         age       stage </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.130439814 0.051880867 0.038308025 0.025115249 0.023826061 0.020354822 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##     albumin     ascites        chol         ast     spiders      hepato </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.019997729 0.015918292 0.013320469 0.010086726 0.007409116 0.007326714 </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##       edema         trt    alk.phos        trig    platelet </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.006844435 0.003214544 0.002517057 0.002469545 0.001056829</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/orsf_vi.html">orsf_vi_permute</a></span><span class="op">(</span><span class="va">fit_no_vi</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##          bili        copper           age       ascites       protime </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0592069141  0.0237362075  0.0136479213  0.0130805894  0.0123091354 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##         stage       albumin          chol        hepato           ast </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0117177661  0.0106414724  0.0064501213  0.0058813969  0.0057753740 </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##         edema       spiders           sex          trig      platelet </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0052171180  0.0048427005  0.0023386947  0.0017883700  0.0013533691 </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">##      alk.phos           trt </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0006492029 -0.0009921507</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="oblique-random-forest-and-vi-all-at-once">Oblique random forest and VI all at once<a class="anchor" aria-label="anchor" href="#oblique-random-forest-and-vi-all-at-once"></a></h3>


<p>fit an oblique random forest and compute vi at the same time</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_permute_vi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                       importance <span class="op">=</span> <span class="st">'permute'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the vi instantly (i.e., it doesn't need to be computed again)</span></span>
<span><span class="fu"><a href="../reference/orsf_vi.html">orsf_vi_permute</a></span><span class="op">(</span><span class="va">fit_permute_vi</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##          bili        copper       ascites       protime       albumin </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0571305446  0.0243657146  0.0138318057  0.0133401675  0.0130746154 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##           age         stage          chol           ast       spiders </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0123610374  0.0102963203  0.0077895394  0.0075250059  0.0048628813 </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##         edema        hepato           sex      platelet          trig </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0046003168  0.0039818730  0.0016891584  0.0012767063  0.0007324402 </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">##      alk.phos           trt </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0005128897 -0.0014443967</span></span></code></pre><p></p></div>
<p>You can still get negation VI from this fit, but it needs to be computed</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/orsf_vi.html">orsf_vi_negate</a></span><span class="op">(</span><span class="va">fit_permute_vi</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##        bili      copper         sex     protime       stage         age </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.123331760 0.052544318 0.037291358 0.024977898 0.023239189 0.021934511 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##     albumin     ascites        chol         ast     spiders       edema </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.020586632 0.014229536 0.014053040 0.012227048 0.007643156 0.006832766 </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      hepato         trt    alk.phos        trig    platelet </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.006301693 0.004348705 0.002371797 0.002309396 0.001347035</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="custom-functions-for-vi">Custom functions for VI<a class="anchor" aria-label="anchor" href="#custom-functions-for-vi"></a></h3>


<p>The default prediction accuracy functions work well most of the time:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">penguins_orsf</span>, <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">.</span>, tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default method for prediction accuracy with VI is R-squared</span></span>
<span><span class="fu"><a href="../reference/orsf_vi.html">orsf_vi_permute</a></span><span class="op">(</span><span class="va">fit_standard</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##           species flipper_length_mm       body_mass_g     bill_depth_mm </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##      0.3725898166      0.3261834607      0.2225730676      0.1026569498 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##            island               sex              year </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##      0.0876071687      0.0844807334      0.0006978493</span></span></code></pre><p></p></div>
<p>But sometimes you want to do something specific and the defaults just
won’t work. For these cases, you can compute VI with any function you’d
like to measure prediction accuracy by supplying a valid function to the
<code>oobag_fun</code> input. For example, we use mean absolute error below. Higher
values are considered good when <code>aorsf</code> computes prediction accuracy, so
we make our function return a pseudo R-squared based on mean absolute
error:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">rsq_mae</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y_mat</span>, <span class="va">w_vec</span>, <span class="va">s_vec</span><span class="op">)</span><span class="op">{</span></span>
<span> </span>
<span> <span class="va">mae_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">(</span><span class="va">y_mat</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y_mat</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">w_vec</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">mae_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">(</span><span class="va">y_mat</span> <span class="op">-</span> <span class="va">s_vec</span><span class="op">)</span> <span class="op">*</span> <span class="va">w_vec</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span> <span class="fl">1</span> <span class="op">-</span> <span class="va">mae_fit</span> <span class="op">/</span> <span class="va">mae_standard</span></span>
<span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fit_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_update.html">orsf_update</a></span><span class="op">(</span><span class="va">fit_standard</span>, oobag_fun <span class="op">=</span> <span class="va">rsq_mae</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># not much changes, but the difference between variables shrinks</span></span>
<span><span class="co"># and the ordering of sex and island has swapped</span></span>
<span><span class="fu"><a href="../reference/orsf_vi.html">orsf_vi_permute</a></span><span class="op">(</span><span class="va">fit_custom</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##           species flipper_length_mm       body_mass_g     bill_depth_mm </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##       0.206951751       0.193248912       0.140899603       0.076759148 </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##               sex            island              year </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##       0.073042331       0.050851073       0.003633365</span></span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Harrell FE, Califf RM, Pryor DB, Lee KL, Rosati RA. Evaluating the Yield of Medical Tests. <em>JAMA</em>. 1982; 247(18):2543-2546. DOI: 10.1001/jama.1982.03320430047030</p>
<p>Breiman L. Random forests. <em>Machine learning</em>. 2001 Oct; 45(1):5-32. DOI: 10.1023/A:1010933404324</p>
<p>Menze BH, Kelm BM, Splitthoff DN, Koethe U, Hamprecht FA. On oblique random forests. <em>Joint European Conference on Machine Learning and Knowledge Discovery in Databases</em>. 2011 Sep 4; pp. 453-469. DOI: 10.1007/978-3-642-23783-6_29</p>
<p>Jaeger BC, Welden S, Lenoir K, Speiser JL, Segar MW, Pandey A, Pajewski NM. Accelerated and interpretable oblique random survival forests. <em>Journal of Computational and Graphical Statistics</em>. Published online 08 Aug 2023. DOI: 10.1080/10618600</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

