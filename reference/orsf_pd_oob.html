<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Compute partial dependence for an oblique random forest.
Partial dependence (PD) shows the expected prediction from a model as a function of a single predictor or multiple predictors. The expectation is marginalized over the values of all other predictors, giving something like a multivariable adjusted estimate of the model's prediction.
You can compute partial dependence three ways using a random forest:
using in-bag predictions for the training data
using out-of-bag predictions for the training data
using predictions for a new set of data


See examples for more details"><title>Partial dependence — orsf_pd_oob • aorsf</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Partial dependence — orsf_pd_oob"><meta property="og:description" content="Compute partial dependence for an oblique random forest.
Partial dependence (PD) shows the expected prediction from a model as a function of a single predictor or multiple predictors. The expectation is marginalized over the values of all other predictors, giving something like a multivariable adjusted estimate of the model's prediction.
You can compute partial dependence three ways using a random forest:
using in-bag predictions for the training data
using out-of-bag predictions for the training data
using predictions for a new set of data


See examples for more details"><meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/aorsf.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pd.html">PD and ICE curves with ORSF</a>
    <a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a>
    <a class="dropdown-item" href="../articles/fast.html">Tips to speed up computation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/aorsf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Partial dependence</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/aorsf/blob/HEAD/R/orsf_pd.R" class="external-link"><code>R/orsf_pd.R</code></a></small>
      <div class="d-none name"><code>orsf_pd_oob.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute partial dependence for an oblique random forest.
Partial dependence (PD) shows the expected prediction from a model as a function of a single predictor or multiple predictors. The expectation is marginalized over the values of all other predictors, giving something like a multivariable adjusted estimate of the model's prediction.
You can compute partial dependence three ways using a random forest:</p><ul><li><p>using in-bag predictions for the training data</p></li>
<li><p>using out-of-bag predictions for the training data</p></li>
<li><p>using predictions for a new set of data</p></li>
</ul><p>See examples for more details</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orsf_pd_oob</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">pred_spec</span>,</span>
<span>  pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  expand_grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prob_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  prob_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lwr"</span>, <span class="st">"medn"</span>, <span class="st">"upr"</span><span class="op">)</span>,</span>
<span>  boundary_checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_pd_inb</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">pred_spec</span>,</span>
<span>  pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  expand_grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prob_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  prob_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lwr"</span>, <span class="st">"medn"</span>, <span class="st">"upr"</span><span class="op">)</span>,</span>
<span>  boundary_checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_pd_new</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">pred_spec</span>,</span>
<span>  <span class="va">new_data</span>,</span>
<span>  pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na_action <span class="op">=</span> <span class="st">"fail"</span>,</span>
<span>  expand_grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prob_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  prob_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lwr"</span>, <span class="st">"medn"</span>, <span class="st">"upr"</span><span class="op">)</span>,</span>
<span>  boundary_checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>(<em>ObliqueForest</em>) a trained oblique random forest object (see <a href="orsf.html">orsf</a>).</p></dd>


<dt>pred_spec</dt>
<dd><p>(<em>named list</em>, <em>pspec_auto</em>, or <em>data.frame</em>).</p><ul><li><p>If <code>pred_spec</code> is a named list,
Each item in the list should be a vector of values that will be used as
points in the partial dependence function. The name of each item in the
list should indicate which variable will be modified to take the
corresponding values.</p></li>
<li><p>If <code>pred_spec</code> is created using <code><a href="pred_spec_auto.html">pred_spec_auto()</a></code>, all that is needed
is the names of variables to use (see <a href="pred_spec_auto.html">pred_spec_auto</a>).</p></li>
<li><p>If <code>pred_spec</code> is a <code>data.frame</code>, columns will
indicate variable names, values will indicate variable values, and
partial dependence will be computed using the inputs on each row.</p></li>
</ul></dd>


<dt>pred_horizon</dt>
<dd><p>(<em>double</em>) Only relevent for survival forests.
A value or vector indicating the time(s) that predictions will be
calibrated to. E.g., if you were predicting risk of incident heart
failure within the next 10 years, then <code>pred_horizon = 10</code>.
<code>pred_horizon</code> can be <code>NULL</code> if <code>pred_type</code> is <code>'mort'</code>, since
mortality predictions are aggregated over all event times</p></dd>


<dt>pred_type</dt>
<dd><p>(<em>character</em>) the type of predictions to compute. Valid
Valid options for survival are:</p><ul><li><p>'risk' : probability of having an event at or before <code>pred_horizon</code>.</p></li>
<li><p>'surv' : 1 - risk.</p></li>
<li><p>'chf': cumulative hazard function</p></li>
<li><p>'mort': mortality prediction</p></li>
</ul><p>For classification:</p><ul><li><p>'prob': probability for each class</p></li>
</ul><p>For regression:</p><ul><li><p>'mean': predicted mean, i.e., the expected value</p></li>
</ul></dd>


<dt>expand_grid</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, partial dependence will be
computed at all possible combinations of inputs in <code>pred_spec</code>. If
<code>FALSE</code>, partial dependence will be computed for each variable
in <code>pred_spec</code>, separately.</p></dd>


<dt>prob_values</dt>
<dd><p>(<em>numeric</em>) a vector of values between 0 and 1,
indicating what quantiles will be used to summarize the partial
dependence values at each set of inputs. <code>prob_values</code> should
have the same length as <code>prob_labels</code>. The quantiles are calculated
based on predictions from <code>object</code> at each set of values indicated
by <code>pred_spec</code>.</p></dd>


<dt>prob_labels</dt>
<dd><p>(<em>character</em>) a vector of labels with the same length
as <code>prob_values</code>, with each label indicating what the corresponding
value in <code>prob_values</code> should be labelled as in summarized outputs.
<code>prob_labels</code> should have the same length as <code>prob_values</code>.</p></dd>


<dt>boundary_checks</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, <code>pred_spec</code> will be checked
to make sure the requested values are between the 10th and 90th
percentile in the object's training data. If <code>FALSE</code>, these checks are
skipped.</p></dd>


<dt>n_thread</dt>
<dd><p>(<em>integer</em>) number of threads to use while computing predictions. Default is 0, which allows a suitable number of threads to be used based on availability.</p></dd>


<dt>verbose_progress</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, progress will be
printed to console. If <code>FALSE</code> (the default), nothing will be
printed.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed to or from other methods (not currently used).</p></dd>


<dt>new_data</dt>
<dd><p>a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a>, <a href="https://tibble.tidyverse.org/reference/tibble-package.html" class="external-link">tibble</a>, or <a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a> to compute predictions in.</p></dd>


<dt>na_action</dt>
<dd><p>(<em>character</em>) what should happen when <code>new_data</code> contains missing values (i.e., <code>NA</code> values). Valid options are:</p><ul><li><p>'fail' : an error is thrown if <code>new_data</code> contains <code>NA</code> values</p></li>
<li><p>'omit' : rows in <code>new_data</code> with incomplete data will be dropped</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a <a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a> containing
partial dependence values for the specified variable(s)
and, if relevant, at the specified prediction horizon(s).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Partial dependence has a number of <a href="https://christophm.github.io/interpretable-ml-book/pdp.html#disadvantages-5" class="external-link">known limitations and assumptions</a> that users should be aware of (see Hooker, 2021). In particular, partial dependence is less intuitive when &gt;2 predictors are examined jointly, and it is assumed that the feature(s) for which the partial dependence is computed are not correlated with other features (this is likely not true in many cases). Accumulated local effect plots can be used (see <a href="https://christophm.github.io/interpretable-ml-book/ale.html" class="external-link">here</a>) in the case where feature independence is not a valid assumption.</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
    <p>You can compute partial dependence and individual conditional
expectations in three ways:</p><ul><li><p>using in-bag predictions for the training data. In-bag partial
dependence indicates relationships that the model has learned during
training. This is helpful if your goal is to interpret the model.</p></li>
<li><p>using out-of-bag predictions for the training data. Out-of-bag partial
dependence indicates relationships that the model has learned during
training but using the out-of-bag data simulates application of the
model to new data. This is helpful if you want to test your model’s
reliability or fairness in new data but you don’t have access to a
large testing set.</p></li>
<li><p>using predictions for a new set of data. New data partial dependence
shows how the model predicts outcomes for observations it has not
seen. This is helpful if you want to test your model’s reliability or
fairness.</p></li>
</ul><div class="section">
<h3 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a></h3>


<p>Begin by fitting an oblique classification random forest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">penguins_orsf_train</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">penguins_orsf_test</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_clsf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins_orsf_train</span>, </span>
<span>                 formula <span class="op">=</span> <span class="va">species</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compute partial dependence using out-of-bag data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_oob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_oob</a></span><span class="op">(</span><span class="va">fit_clsf</span>, pred_spec <span class="op">=</span> <span class="va">pred_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_oob</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Key: &lt;class&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##        class flipper_length_mm      mean         lwr       medn       upr</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##       &lt;fctr&gt;             &lt;num&gt;     &lt;num&gt;       &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:    Adelie               190 0.6176908 0.202278109 0.75856417 0.9810614</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:    Adelie               210 0.4338528 0.019173811 0.56489202 0.8648110</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3: Chinstrap               190 0.2114979 0.017643385 0.15211271 0.7215181</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4: Chinstrap               210 0.1803019 0.020108201 0.09679464 0.7035053</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5:    Gentoo               190 0.1708113 0.001334861 0.02769695 0.5750201</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 6:    Gentoo               210 0.3858453 0.068685035 0.20717073 0.9532853</span></span></code></pre><p></p></div>
<p>Note that predicted probabilities are returned for each class and
probabilities in the <code>mean</code> column sum to 1 if you take the sum over
each class at a specific value of the <code>pred_spec</code> variables. For
example,</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pd_oob</span><span class="op">[</span><span class="va">flipper_length_mm</span> <span class="op">==</span> <span class="fl">190</span>, <span class="va">mean</span><span class="op">]</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span></code></pre><p></p></div>
<p>But this isn’t the case for the median predicted probability!</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pd_oob</span><span class="op">[</span><span class="va">flipper_length_mm</span> <span class="op">==</span> <span class="fl">190</span>, <span class="va">medn</span><span class="op">]</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.9383738</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a></h3>


<p>Begin by fitting an oblique regression random forest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">penguins_orsf_train</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">penguins_orsf_test</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_regr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins_orsf_train</span>, </span>
<span>                 formula <span class="op">=</span> <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compute partial dependence using new data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    flipper_length_mm     mean      lwr     medn      upr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:               190 42.96571 37.09805 43.69769 48.72301</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:               210 45.66012 40.50693 46.31577 51.65163</span></span></code></pre><p></p></div>
<p>You can also let <code>pred_spec_auto</code> pick reasonable values like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pred_spec</span> <span class="op">=</span> <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##       species    island body_mass_g     mean      lwr     medn      upr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##        &lt;fctr&gt;    &lt;fctr&gt;       &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  1:    Adelie    Biscoe        3200 40.31374 37.24373 40.31967 44.22824</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  2: Chinstrap    Biscoe        3200 45.10582 42.63342 45.10859 47.60119</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  3:    Gentoo    Biscoe        3200 42.81649 40.19221 42.55664 46.84035</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  4:    Adelie     Dream        3200 40.16219 36.95895 40.34633 43.90681</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  5: Chinstrap     Dream        3200 46.21778 43.53954 45.90929 49.19173</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  6:    Gentoo     Dream        3200 42.60465 39.89647 42.63520 46.28769</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  7:    Adelie Torgersen        3200 39.91652 36.80227 39.79806 43.68842</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  8: Chinstrap Torgersen        3200 44.27807 41.95470 44.40742 46.68848</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  9:    Gentoo Torgersen        3200 42.09510 39.49863 41.80049 45.81833</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 10:    Adelie    Biscoe        3550 40.77971 38.04027 40.59561 44.57505</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 11: Chinstrap    Biscoe        3550 45.81304 43.52102 45.73116 48.36366</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 12:    Gentoo    Biscoe        3550 43.31233 40.77355 43.03077 47.22936</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 13:    Adelie     Dream        3550 40.77741 38.07399 40.78175 44.37273</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 14: Chinstrap     Dream        3550 47.30926 44.80493 46.77540 50.47092</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 15:    Gentoo     Dream        3550 43.26955 40.86119 43.16204 46.89190</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 16:    Adelie Torgersen        3550 40.25780 37.35251 40.07871 44.04576</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 17: Chinstrap Torgersen        3550 44.77911 42.60161 44.81944 47.14986</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 18:    Gentoo Torgersen        3550 42.49520 39.95866 42.14160 46.26237</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 19:    Adelie    Biscoe        3975 41.61744 38.94515 41.36634 45.38752</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 20: Chinstrap    Biscoe        3975 46.59363 44.59970 46.44923 49.11457</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 21:    Gentoo    Biscoe        3975 44.07857 41.60792 43.74562 47.85109</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 22:    Adelie     Dream        3975 41.50511 39.06187 41.24741 45.13027</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 23: Chinstrap     Dream        3975 48.14978 45.87390 47.54867 51.50683</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 24:    Gentoo     Dream        3975 44.01928 41.70577 43.84099 47.50470</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 25:    Adelie Torgersen        3975 40.94764 38.12519 40.66759 44.73689</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 26: Chinstrap Torgersen        3975 45.44820 43.49986 45.44036 47.63243</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 27:    Gentoo Torgersen        3975 43.13791 40.70628 42.70627 46.87306</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 28:    Adelie    Biscoe        4700 42.93914 40.48463 42.44768 46.81756</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 29: Chinstrap    Biscoe        4700 47.18534 45.40866 47.07739 49.55747</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 30:    Gentoo    Biscoe        4700 45.32541 43.08173 44.93498 49.23391</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="do">## 31:    Adelie     Dream        4700 42.73806 40.44229 42.22226 46.49936</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 32: Chinstrap     Dream        4700 48.37354 46.34335 48.00781 51.18955</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 33:    Gentoo     Dream        4700 45.09132 42.88328 44.79530 48.82180</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 34:    Adelie Torgersen        4700 42.09349 39.72074 41.56168 45.68838</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="do">## 35: Chinstrap Torgersen        4700 46.17045 44.39042 46.09525 48.35127</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 36:    Gentoo Torgersen        4700 44.31621 42.18968 43.81773 47.98024</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="do">## 37:    Adelie    Biscoe        5300 43.89769 41.43335 43.28504 48.10892</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 38: Chinstrap    Biscoe        5300 47.53721 45.66038 47.52770 49.88701</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="do">## 39:    Gentoo    Biscoe        5300 46.16115 43.81722 45.59309 50.57469</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="do">## 40:    Adelie     Dream        5300 43.59846 41.25825 43.24518 47.46193</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="do">## 41: Chinstrap     Dream        5300 48.48139 46.36282 48.25679 51.02996</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="do">## 42:    Gentoo     Dream        5300 45.91819 43.62832 45.54110 49.91622</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="do">## 43:    Adelie Torgersen        5300 42.92879 40.66576 42.31072 46.76406</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="do">## 44: Chinstrap Torgersen        5300 46.59576 44.80400 46.49196 49.03906</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="do">## 45:    Gentoo Torgersen        5300 45.11384 42.95190 44.51289 49.27629</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="do">##       species    island body_mass_g     mean      lwr     medn      upr</span></span></code></pre><p></p></div>
<p>By default, all combinations of all variables are used. However, you can
also look at the variables one by one, separately, like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      expand_grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##        variable value     level     mean      lwr     medn      upr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##          &lt;char&gt; &lt;num&gt;    &lt;char&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  1:     species    NA    Adelie 41.90271 37.10417 41.51723 48.51478</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  2:     species    NA Chinstrap 47.11314 42.40419 46.96478 51.51392</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  3:     species    NA    Gentoo 44.37038 39.87306 43.89889 51.21635</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  4:      island    NA    Biscoe 44.21332 37.22711 45.27862 51.21635</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  5:      island    NA     Dream 44.43354 37.01471 45.57261 51.51392</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  6:      island    NA Torgersen 43.29539 37.01513 44.26924 49.84391</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  7: body_mass_g  3200      &lt;NA&gt; 42.84625 37.03978 43.95991 49.19173</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  8: body_mass_g  3550      &lt;NA&gt; 43.53326 37.56730 44.43756 50.47092</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  9: body_mass_g  3975      &lt;NA&gt; 44.30431 38.31567 45.22089 51.50683</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 10: body_mass_g  4700      &lt;NA&gt; 45.22559 39.88199 46.34680 51.18955</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 11: body_mass_g  5300      &lt;NA&gt; 45.91412 40.84742 46.95327 51.48851</span></span></code></pre><p></p></div>
<p>And you can also bypass all the bells and whistles by using your own
<code>data.frame</code> for a <code>pred_spec</code>. (Just make sure you request values that
exist in the training data.)</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">custom_pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">'Adelie'</span>, </span>
<span>                               island <span class="op">=</span> <span class="st">'Biscoe'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      pred_spec <span class="op">=</span> <span class="va">custom_pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    species island     mean      lwr     medn      upr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##     &lt;fctr&gt; &lt;fctr&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:  Adelie Biscoe 41.98024 37.22711 41.65252 48.51478</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="survival">Survival<a class="anchor" aria-label="anchor" href="#survival"></a></h3>


<p>Begin by fitting an oblique survival random forest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pbc_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pbc_orsf_train</span> <span class="op">&lt;-</span> <span class="va">pbc_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">pbc_orsf_test</span> <span class="op">&lt;-</span> <span class="va">pbc_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf_train</span>, </span>
<span>                 formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                 oobag_pred_horizon <span class="op">=</span> <span class="fl">365.25</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compute partial dependence using in-bag data for <code>bili = c(1,2,3,4,5)</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pd_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, pred_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bili <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pd_train</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    pred_horizon  bili      mean        lwr      medn       upr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##           &lt;num&gt; &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:      1826.25     1 0.2566200 0.02234786 0.1334170 0.8918909</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:      1826.25     2 0.3121392 0.06853733 0.1896849 0.9204338</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3:      1826.25     3 0.3703242 0.11409793 0.2578505 0.9416791</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4:      1826.25     4 0.4240692 0.15645214 0.3331057 0.9591581</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5:      1826.25     5 0.4663670 0.20123406 0.3841700 0.9655296</span></span></code></pre><p></p></div>
<p>If you don’t have specific values of a variable in mind, let
<code>pred_spec_auto</code> pick for you:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pd_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pd_train</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    pred_horizon  bili      mean        lwr      medn       upr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##           &lt;num&gt; &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:      1826.25  0.55 0.2481444 0.02035041 0.1242215 0.8801444</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:      1826.25  0.70 0.2502831 0.02045039 0.1271039 0.8836536</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3:      1826.25  1.50 0.2797763 0.03964900 0.1601715 0.9041584</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4:      1826.25  3.50 0.3959349 0.13431288 0.2920400 0.9501230</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5:      1826.25  7.25 0.5351935 0.28064629 0.4652185 0.9783000</span></span></code></pre><p></p></div>
<p>Specify <code>pred_horizon</code> to get partial dependence at each value:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pd_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span>,</span>
<span>                        pred_horizon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">3000</span>, by <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pd_train</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##     pred_horizon  bili       mean         lwr        medn       upr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##            &lt;num&gt; &lt;num&gt;      &lt;num&gt;       &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  1:          500  0.55 0.06171990 0.000443399 0.008654190 0.5907104</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  2:         1000  0.55 0.14185009 0.005793742 0.055728527 0.7360749</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  3:         1500  0.55 0.20825053 0.013609478 0.091745579 0.8556319</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  4:         2000  0.55 0.26790167 0.023047689 0.145741690 0.8910549</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  5:         2500  0.55 0.31796166 0.063797305 0.202544999 0.9017710</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  6:         3000  0.55 0.39108086 0.090852131 0.301804690 0.9234812</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  7:          500  0.70 0.06240527 0.000443399 0.008934806 0.5980510</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  8:         1000  0.70 0.14313570 0.006159694 0.056348007 0.7432448</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  9:         1500  0.70 0.21012128 0.013717586 0.092461532 0.8597396</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 10:         2000  0.70 0.27013021 0.023169510 0.146344595 0.8935664</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 11:         2500  0.70 0.31880954 0.062506113 0.201979102 0.9068170</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 12:         3000  0.70 0.39286323 0.089707173 0.308392927 0.9252028</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 13:          500  1.50 0.06679162 0.001271788 0.011028398 0.6241228</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 14:         1000  1.50 0.15727919 0.011478962 0.068332010 0.7678732</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 15:         1500  1.50 0.23316655 0.028732095 0.117289745 0.8789647</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 16:         2000  1.50 0.30139227 0.046792721 0.180096425 0.9144202</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 17:         2500  1.50 0.35260943 0.084586675 0.238015966 0.9266065</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 18:         3000  1.50 0.43512074 0.131110330 0.346025144 0.9438562</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 19:          500  3.50 0.08638646 0.005208753 0.028239001 0.6740930</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 20:         1000  3.50 0.22353655 0.051917978 0.139604845 0.8283986</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 21:         1500  3.50 0.32700976 0.090198324 0.217982772 0.9371150</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 22:         2000  3.50 0.41618105 0.144532860 0.311508093 0.9566091</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 23:         2500  3.50 0.49248461 0.219511094 0.402095677 0.9636221</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 24:         3000  3.50 0.56008108 0.263569896 0.503253258 0.9734948</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 25:          500  7.25 0.12585007 0.022092057 0.063550987 0.7543806</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 26:         1000  7.25 0.32646274 0.135343689 0.259567907 0.8884333</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 27:         1500  7.25 0.46412653 0.218208755 0.387874346 0.9702903</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 28:         2000  7.25 0.55117610 0.293367409 0.484277295 0.9812413</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 29:         2500  7.25 0.62002385 0.371965247 0.569543990 0.9845058</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 30:         3000  7.25 0.68034820 0.425128031 0.646423180 0.9888637</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="do">##     pred_horizon  bili       mean         lwr        medn       upr</span></span></code></pre><p></p></div>
<p>vector-valued <code>pred_horizon</code> input comes with minimal extra
computational cost. Use a fine grid of time values and assess whether
predictors have time-varying effects. (see partial dependence vignette
for example)</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    
<ol><li><p>Hooker, Giles, Mentch, Lucas, Zhou, Siyu (2021). "Unrestricted
permutation forces extrapolation: variable importance requires at least
one more model, or there is no free variable importance." <em>Statistics
and Computing</em>, <em>31</em>, 1-16.</p></li>
</ol></div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

