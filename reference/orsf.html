<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Oblique Random Survival Forest (ORSF)"><title>Oblique Random Survival Forest (ORSF) — orsf • aorsf</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Oblique Random Survival Forest (ORSF) — orsf"><meta property="og:description" content="Oblique Random Survival Forest (ORSF)"><meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/aorsf.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pd.html">Compute partial dependence with ORSF</a>
    <a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bcjaeger/aorsf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Oblique Random Survival Forest (ORSF)</h1>
      <small class="dont-index">Source: <a href="https://github.com/bcjaeger/aorsf/blob/HEAD/R/orsf.R" class="external-link"><code>R/orsf.R</code></a></small>
      <div class="d-none name"><code>orsf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Oblique Random Survival Forest (ORSF)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orsf</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">formula</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="orsf_control_cph.html">orsf_control_cph</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_tree <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_split <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  n_retry <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  mtry <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  leaf_min_events <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  leaf_min_obs <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  split_min_events <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  split_min_obs <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  split_min_stat <span class="op">=</span> <span class="fl">3.841459</span>,</span>
<span>  oobag_pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  oobag_pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  oobag_eval_every <span class="op">=</span> <span class="va">n_tree</span>,</span>
<span>  oobag_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  importance <span class="op">=</span> <span class="st">"anova"</span>,</span>
<span>  tree_seeds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  attach_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  no_fit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_train</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>(<em>data.frame</em>) that contains the relevant variables.</p></dd>


<dt>formula</dt>
<dd><p>(<em>formula</em>) a formula object, with the response on the left
of a <code>~</code> operator, and the terms on the right (see details). Variables
on the right hand size of the <code>~</code> can be numeric, integer, or factor
variables. Factors may be ordered or unordered.</p></dd>


<dt>control</dt>
<dd><p>An <code>aorsf_control</code> object, created with <a href="orsf_control_net.html">orsf_control_net</a>
or <a href="orsf_control_cph.html">orsf_control_cph</a>. Default is <code>control = orsf_control_cph()</code>.</p></dd>


<dt>weights</dt>
<dd><p>(<em>double</em>) an optional vector of weights. If given, this
input should be a vector with length equal to the number of rows in
<code>data</code>. The values in <code>weights</code> are treated like replication weights,
i.e., a weight value of 2 is the same thing as having 2 observations
in <code>data</code>, each containing a copy of the corresponding person's data.
<strong>Use this input cautiously</strong>, as <code>orsf</code> will count the number of
observations and events prior to growing a node for a tree, so higher
values in <code>weights</code> will lead to deeper trees.</p></dd>


<dt>n_tree</dt>
<dd><p>(<em>integer</em>) the number of trees to grow.
Default is <code>n_tree = 500.</code></p></dd>


<dt>n_split</dt>
<dd><p>(<em>integer</em>) the number of cut-points assessed when splitting
a node in decision trees. Default is <code>n_split = 5</code>.</p></dd>


<dt>n_retry</dt>
<dd><p>(<em>integer</em>) when a node can be split, but the current
linear combination of inputs is unable to provide a valid split, <code>orsf</code>
will try again with a new linear combination based on a different set
of randomly selected predictors, up to <code>n_retry</code> pred_horizon. When
<code>n_retry = 0</code> the retry mechanic is not applied.
Default is <code>n_retry = 3</code>.</p></dd>


<dt>mtry</dt>
<dd><p>(<em>integer</em>) Number of variables randomly selected as candidates
for splitting a node. The default is the smallest integer greater than
the square root of the number of features, i.e.,
<code>mtry = ceiling(sqrt(number of predictors))</code></p></dd>


<dt>leaf_min_events</dt>
<dd><p>(<em>integer</em>) minimum number of events in a
leaf node. Default is <code>leaf_min_events = 1</code></p></dd>


<dt>leaf_min_obs</dt>
<dd><p>(<em>integer</em>) minimum number of observations in a
leaf node. Default is <code>leaf_min_obs = 5</code></p></dd>


<dt>split_min_events</dt>
<dd><p>(<em>integer</em>) minimum number of events required
to split a node. Default is <code>split_min_events = 5</code></p></dd>


<dt>split_min_obs</dt>
<dd><p>(<em>integer</em>) minimum number of observations required
to split a node. Default is <code>split_min_obs = 10</code>.</p></dd>


<dt>split_min_stat</dt>
<dd><p>(double) minimum test statistic required to split
a node. Default is 3.841459 for the log-rank test, which is roughly
a p-value of 0.05</p></dd>


<dt>oobag_pred</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code> out-of-bag predictions are returned
in the <code>aorsf</code> object. Default is <code>TRUE</code>.</p></dd>


<dt>oobag_pred_horizon</dt>
<dd><p>(<em>numeric</em>) A numeric value indicating what time
should be used for out-of-bag predictions. Default is the median
of the observed times, i.e., <code>oobag_pred_horizon = median(time)</code>.</p></dd>


<dt>oobag_eval_every</dt>
<dd><p>(<em>integer</em>) The out-of-bag performance of the
ensemble will be checked every <code>oobag_eval_every</code> trees. So, if
<code>oobag_eval_every = 10</code>, then out-of-bag performance is checked
after growing the 10th tree, the 20th tree, and so on. Default
is <code>oobag_eval_every = n_tree</code>, so that out-of-bag performance is
assessed once after growing all the trees.</p></dd>


<dt>oobag_fun</dt>
<dd><p>(<em>function</em>) When <code>oobag_fun</code> = <code>NULL</code> (the default),
out-of-bag predictions are evaluated using Harrell's C-statistic.
If a value for <code>oobag_fun</code> is provided, it will be used in place of
Harrell's C-statistic to evaluate out-of-bag predictions. See details.</p></dd>


<dt>importance</dt>
<dd><p>(<em>character</em>) Indicate method for variable importance:</p><ul><li><p>'none': no variable importance is computed.</p></li>
<li><p>'anova': use the analysis of variance (ANOVA) method</p></li>
<li><p>'negate': compute negation importance</p></li>
<li><p>'permute': compute permutation importance</p></li>
</ul><p>See <a href="orsf_vi.html">orsf_vi</a> for descriptions of the available methods.</p></dd>


<dt>tree_seeds</dt>
<dd><p>(<em>integer vector</em>) if specified, random seeds will be set
using the values in <code>tree_seeds[i]</code>  before growing tree i. Two forests
grown with the same number of trees and the same seeds will have the exact
same out-of-bag samples and, in many cases, the same random sets of
candidate predictors. This design makes comparisons of out-of-bag error
between two random forests more meaningful, since the out-of-bag
performance of a random forest depends somewhat on the observations
picked in out-of-bag samples. If <code>tree_seeds</code> is <code>NULL</code> (the default),
no seeds are set during the training process.</p></dd>


<dt>attach_data</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, a copy of the training
data will be attached to the output. This is helpful if you
plan on using functions like <a href="orsf_pd_summary.html">orsf_pd_summary</a> to interpret the fitted
forest using its training data. Default is <code>TRUE</code>.</p></dd>


<dt>no_fit</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, pre-processing steps are defined and
parametrized, but training is not initiated. The object returned can be
directly submitted to <code>orsf_train()</code> so long as <code>attach_data</code> is <code>TRUE</code>.</p></dd>


<dt>...</dt>
<dd><p>not currently used.</p></dd>


<dt>object</dt>
<dd><p>an untrained aorsf object, created by setting
<code>no_fit = TRUE</code> in <code>orsf()</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an accelerated oblique RSF object (<code>aorsf</code>)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is based on and highly similar to the <code>ORSF</code> function
in the <code>obliqueRSF</code> R package. The primary difference is that this
function runs much faster. The speed increase is attributable to better
management of memory (i.e., no unnecessary copies of inputs) and using
a Newton Raphson scoring algorithm to identify linear combinations of
inputs rather than performing penalized regression using routines in
<code>glmnet</code>.The modified Newton Raphson scoring algorithm that this
function applies is an adaptation of the C++ routine developed by
Terry M. Therneau that fits Cox proportional hazards models
(see <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code> and more specifically <code><a href="https://rdrr.io/pkg/survival/man/agreg.fit.html" class="external-link">survival::coxph.fit()</a></code>).</p>
<p><strong>Some comments on inputs</strong></p>
<p><em>formula</em>: The response in <code>formula</code> can be a survival
object as returned by the <a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">survival::Surv</a> function,
but can also just be the time and status variables.
For example, <code>Surv(time, status) ~ .</code> works just like
<code>time + status ~ .</code>. The only thing that can break this
input is putting the variables in the wrong order, i.e.,
writing <code>status + time ~ .</code> will make <code>orsf</code> assume your
<code>status</code> variable is actually the <code>time</code> variable.</p>
<p><em>mtry</em>: The <code>mtry</code> parameter may be temporarily reduced to ensure there
are at least 2 events per predictor variable. This occurs when using
<a href="orsf_control_cph.html">orsf_control_cph</a> because coefficients in the Newton Raphson scoring
algorithm may become unstable when the number of covariates is
greater than or equal to the number of events. This reduction does not
occur when using <a href="orsf_control_net.html">orsf_control_net</a>.</p>
<p><em>oobag_fun</em>: The function must have two inputs: <code>y_mat</code> and <code>s_vec</code>.</p><ul><li><p>The input <code>y_mat</code> is presumed to be a matrix with two columns
named <code>time</code> (first column) and <code>status</code> (second column).</p></li>
<li><p>The input <code>s_vec</code> is presumed to be a numeric vector containing
predicted survival probabilities for <code>y_mat</code>.</p></li>
</ul><p>If <code>oobag_fun</code> is specified, it will be used in the
computation of negation importance or permutation importance, but it
will not have any role for ANOVA importance.</p>
<p><strong>What is an oblique decision tree?</strong></p>
<p>Decision trees are developed by splitting a set of training data into two
new subsets, with the goal of having more similarity within the new subsets
than between them. This splitting process is repeated on the resulting
subsets of data until a stopping criterion is met. When the new subsets of
data are formed based on a single predictor, the decision tree is said to
be axis-based because the splits of the data appear perpendicular to the
axis of the predictor. When linear combinations of variables are used
instead of a single variable, the tree is oblique because the splits of
the data are neither parallel nor at a right angle to the axis</p>
<p><em>Figure</em> : Decision trees for classification with axis-based splitting
(left) and oblique splitting (right). Cases are orange squares; controls
are purple circles. Both trees partition the predictor space defined by
variables X1 and X2, but the oblique splits do a better job of separating
the two classes.</p>
<p><img src="figures/tree_axis_v_oblique.png" width="95%"></p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Breiman L. Random forests. <em>Machine learning</em>. 2001 Oct;45(1):5-32.
DOI: 10.1023/A:1010933404324</p>
<p>Ishwaran H, Kogalur UB, Blackstone EH, Lauer MS. Random survival forests.
<em>Annals of applied statistics</em>. 2008 Sep;2(3):841-60.
DOI: 10.1214/08-AOAS169</p>
<p>Jaeger BC, Long DL, Long DM, Sims M, Szychowski JM, Min YI,
Mcclure LA, Howard G, Simon N. Oblique random survival forests.
<em>Annals of applied statistics</em>. 2019 Sep;13(3):1847-83.
DOI: 10.1214/19-AOAS1261</p>
<p>Jaeger BC, Welden S, Lenoir K, Speiser JL, Segar M, Pandey A, Pajewski NM.
Accelerated and interpretable oblique random survival forests.
arXiv e-prints. 2022 Aug 3:arXiv-2208.
URL: https://arxiv.org/abs/2208.01129</p>
<p>Harrell FE, Califf RM, Pryor DB, Lee KL, Rosati RA.
Evaluating the Yield of Medical Tests. <em>JAMA</em>. 1982;247(18):2543–2546.
DOI: 10.1001/jama.1982.03320430047030</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># standard workflow for model development: fit and interpret</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">orsf</span><span class="op">(</span><span class="va">pbc_orsf</span>, formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------- Oblique random survival forest</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           N observations: 276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 N events: 111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  N trees: 500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       N predictors total: 17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    N predictors per node: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Average leaves per tree: 24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Min observations in leaf: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Min events in leaf: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           OOB stat value: 0.84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            OOB stat type: Harrell's C-statistic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Variable importance: anova</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------------------------</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># more specific parameters</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_custom</span> <span class="op">&lt;-</span> <span class="fu">orsf</span><span class="op">(</span><span class="va">pbc_orsf</span>,</span></span>
<span class="r-in"><span>                   formula <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">status</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span></span>
<span class="r-in"><span>                   mtry <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                   oobag_pred_horizon <span class="op">=</span> <span class="fl">4000</span>,</span></span>
<span class="r-in"><span>                   oobag_eval_every <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 10 oobag error values are computed  b/c oob error</span></span></span>
<span class="r-in"><span><span class="co"># is assessed every 50 trees (50, 100, ..., 500)</span></span></span>
<span class="r-in"><span><span class="va">fit_custom</span><span class="op">$</span><span class="va">eval_oobag</span><span class="op">$</span><span class="va">stat_values</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,] 0.8155345</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,] 0.8286101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,] 0.8277245</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,] 0.8304855</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,] 0.8337154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,] 0.8346531</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] 0.8362680</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,] 0.8380913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,] 0.8385601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] 0.8368410</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make your own oobag function:</span></span></span>
<span class="r-in"><span><span class="co"># (this is an R implementation of Harrell's C</span></span></span>
<span class="r-in"><span><span class="co"># stat, which is what orsf uses by default)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">oobag_c_harrell</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y_mat</span>, <span class="va">s_vec</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span> <span class="va">time</span> <span class="op">=</span> <span class="va">y_mat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span> <span class="va">status</span> <span class="op">=</span> <span class="va">y_mat</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span> <span class="va">events</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">k</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">y_mat</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span> <span class="va">concordant</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">events</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span> <span class="op">&lt;=</span> <span class="va">k</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span><span class="op">(</span><span class="va">time</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>     <span class="va">total</span> <span class="op">&lt;-</span> <span class="va">total</span> <span class="op">+</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>     <span class="kw">if</span><span class="op">(</span><span class="va">s_vec</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">s_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">concordant</span> <span class="op">&lt;-</span> <span class="va">concordant</span> <span class="op">+</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>     <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">s_vec</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">==</span> <span class="va">s_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">concordant</span> <span class="op">&lt;-</span> <span class="va">concordant</span> <span class="op">+</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span>     <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>   <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span> <span class="op">}</span></span></span>
<span class="r-in"><span> <span class="va">concordant</span> <span class="op">/</span> <span class="va">total</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># tree_seeds lets you grow each tree with the seed it corresponds to</span></span></span>
<span class="r-in"><span><span class="co"># (nice way to make sure my R oobag function gives the same answer</span></span></span>
<span class="r-in"><span><span class="co"># as the internal C oobag function)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_custom_oobag</span> <span class="op">&lt;-</span> <span class="fu">orsf</span><span class="op">(</span><span class="va">pbc_orsf</span>,</span></span>
<span class="r-in"><span>                         formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span></span>
<span class="r-in"><span>                         oobag_fun <span class="op">=</span> <span class="va">oobag_c_harrell</span>,</span></span>
<span class="r-in"><span>                         n_tree <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>                         tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_standard_oobag</span> <span class="op">&lt;-</span> <span class="fu">orsf</span><span class="op">(</span><span class="va">pbc_orsf</span>,</span></span>
<span class="r-in"><span>                           formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span></span>
<span class="r-in"><span>                           n_tree <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>                           tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_standard_oobag</span><span class="op">$</span><span class="va">eval_oobag</span><span class="op">$</span><span class="va">stat_values</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.7736768</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_custom_oobag</span><span class="op">$</span><span class="va">eval_oobag</span><span class="op">$</span><span class="va">stat_values</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.7736768</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

