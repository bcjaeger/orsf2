<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Fit an oblique random survival forest"><title>Oblique Random Survival Forest (ORSF) — orsf • aorsf</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Oblique Random Survival Forest (ORSF) — orsf"><meta property="og:description" content="Fit an oblique random survival forest"><meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/aorsf.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pd.html">PD and ICE curves with ORSF</a>
    <a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/aorsf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Oblique Random Survival Forest (ORSF)</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/aorsf/blob/HEAD/R/orsf.R" class="external-link"><code>R/orsf.R</code></a></small>
      <div class="d-none name"><code>orsf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit an oblique random survival forest</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orsf</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">formula</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="orsf_control_fast.html">orsf_control_fast</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_tree <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_split <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  n_retry <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  mtry <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  leaf_min_events <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  leaf_min_obs <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  split_min_events <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  split_min_obs <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  split_min_stat <span class="op">=</span> <span class="fl">3.841459</span>,</span>
<span>  oobag_pred_type <span class="op">=</span> <span class="st">"surv"</span>,</span>
<span>  oobag_pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  oobag_eval_every <span class="op">=</span> <span class="va">n_tree</span>,</span>
<span>  oobag_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  importance <span class="op">=</span> <span class="st">"anova"</span>,</span>
<span>  tree_seeds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  attach_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  no_fit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_action <span class="op">=</span> <span class="st">"fail"</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_train</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a>, <a href="https://tibble.tidyverse.org/reference/tibble-package.html" class="external-link">tibble</a>, or <a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a> that contains the
relevant variables.</p></dd>


<dt>formula</dt>
<dd><p>(<em>formula</em>) The response on the left hand side should
include a time variable, followed by a status variable, and may be
written inside a call to <a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a> (see examples).
The terms on the right are names of predictor variables.</p></dd>


<dt>control</dt>
<dd><p>(<em>orsf_control</em>) An object returned from one of the
<code>orsf_control</code> functions:</p><ul><li><p><a href="orsf_control_fast.html">orsf_control_fast</a> (the default) uses a single iteration of Newton
Raphson scoring to identify a linear combination of predictors.</p></li>
<li><p><a href="orsf_control_cph.html">orsf_control_cph</a> uses Newton Raphson scoring until a convergence
criteria is met.</p></li>
<li><p><a href="orsf_control_net.html">orsf_control_net</a> uses <code>glmnet</code> to identify linear combinations of
predictors, similar to Jaeger (2019).</p></li>
<li><p><a href="orsf_control_custom.html">orsf_control_custom</a> allows the user to apply their own function
to create linear combinations of predictors.</p></li>
</ul></dd>


<dt>weights</dt>
<dd><p>(<em>numeric vector</em>) Optional. If given, this input should
have length equal to <code>nrow(data)</code>. Values in <code>weights</code> are treated like
replication weights, i.e., a value of 2 is the same thing as having 2
observations in <code>data</code>, each containing a copy of the corresponding
person's data.</p>
<p><em>Use</em> <code>weights</code> <em>cautiously</em>, as <code>orsf</code> will count the number of
observations and events prior to growing a node for a tree, so higher
values in <code>weights</code> will lead to deeper trees.</p></dd>


<dt>n_tree</dt>
<dd><p>(<em>integer</em>) the number of trees to grow.
Default is <code>n_tree = 500.</code></p></dd>


<dt>n_split</dt>
<dd><p>(<em>integer</em>) the number of cut-points assessed when splitting
a node in decision trees. Default is <code>n_split = 5</code>.</p></dd>


<dt>n_retry</dt>
<dd><p>(<em>integer</em>) when a node can be split, but the current
linear combination of inputs is unable to provide a valid split, <code>orsf</code>
will try again with a new linear combination based on a different set
of randomly selected predictors, up to <code>n_retry</code> times. Default is
<code>n_retry = 3</code>. Set <code>n_retry = 0</code> to prevent any retries.</p></dd>


<dt>mtry</dt>
<dd><p>(<em>integer</em>) Number of predictors randomly included as candidates
for splitting a node. The default is the smallest integer greater than
the square root of the number of total predictors, i.e.,
<code>mtry = ceiling(sqrt(number of predictors))</code></p></dd>


<dt>leaf_min_events</dt>
<dd><p>(<em>integer</em>) minimum number of events in a
leaf node. Default is <code>leaf_min_events = 1</code></p></dd>


<dt>leaf_min_obs</dt>
<dd><p>(<em>integer</em>) minimum number of observations in a
leaf node. Default is <code>leaf_min_obs = 5</code></p></dd>


<dt>split_min_events</dt>
<dd><p>(<em>integer</em>) minimum number of events required
in a node to consider splitting it. Default is <code>split_min_events = 5</code></p></dd>


<dt>split_min_obs</dt>
<dd><p>(<em>integer</em>) minimum number of observations required
in a node to consider splitting it. Default is <code>split_min_obs = 10</code>.</p></dd>


<dt>split_min_stat</dt>
<dd><p>(double) minimum test statistic required to split
a node. Default is 3.841459 for the log-rank test, which is roughly
a p-value of 0.05</p></dd>


<dt>oobag_pred_type</dt>
<dd><p>(<em>character</em>) The type of out-of-bag predictions
to compute while fitting the ensemble. Valid options are</p><ul><li><p>'none' : don't compute out-of-bag predictions</p></li>
<li><p>'risk' : predict the probability of having an event at or before <code>oobag_pred_horizon</code>.</p></li>
<li><p>'surv' : 1 - risk.</p></li>
<li><p>'chf'  : predict cumulative hazard function</p></li>
</ul><p>Mortality ('mort')is not implemented for out of bag predictions yet, but it
will be in a future update.</p></dd>


<dt>oobag_pred_horizon</dt>
<dd><p>(<em>numeric</em>) A numeric value indicating what time
should be used for out-of-bag predictions. Default is the median
of the observed times, i.e., <code>oobag_pred_horizon = median(time)</code>.</p></dd>


<dt>oobag_eval_every</dt>
<dd><p>(<em>integer</em>) The out-of-bag performance of the
ensemble will be checked every <code>oobag_eval_every</code> trees. So, if
<code>oobag_eval_every = 10</code>, then out-of-bag performance is checked
after growing the 10th tree, the 20th tree, and so on. Default
is <code>oobag_eval_every = n_tree</code>.</p></dd>


<dt>oobag_fun</dt>
<dd><p>(<em>function</em>) to be used for evaluating out-of-bag prediction accuracy every <code>oobag_eval_every</code>
trees. When <code>oobag_fun = NULL</code> (the default), Harrell's C-statistic (1982) is used to evaluate accuracy. if you use your own <code>oobag_fun</code> note the following:</p><ul><li><p><code>oobag_fun</code> should have two inputs: <code>y_mat</code> and <code>s_vec</code></p></li>
<li><p><code>y_mat</code> is a two column matrix with first column named 'time', second named 'status'</p></li>
<li><p><code>s_vec</code> is a numeric vector containing predicted survival probabilities.</p></li>
<li><p><code>oobag_fun</code> should return a numeric output of length 1</p></li>
</ul><p>For more details, see the out-of-bag <a href="https://docs.ropensci.org/aorsf/articles/oobag.html#user-supplied-out-of-bag-evaluation-functions" class="external-link">vignette</a>.</p></dd>


<dt>importance</dt>
<dd><p>(<em>character</em>) Indicate method for variable importance:</p><ul><li><p>'none': no variable importance is computed.</p></li>
<li><p>'anova': compute analysis of variance (ANOVA) importance</p></li>
<li><p>'negate': compute negation importance</p></li>
<li><p>'permute': compute permutation importance</p></li>
</ul><p>For details on these methods, see <a href="orsf_vi.html">orsf_vi</a>.</p></dd>


<dt>tree_seeds</dt>
<dd><p>(<em>integer vector</em>) Optional. if specified, random seeds
will be set using the values in <code>tree_seeds[i]</code>  before growing tree <code>i</code>.
Two forests grown with the same number of trees and the same seeds will
have the exact same out-of-bag samples, making out-of-bag error
estimates of the forests more comparable. If <code>NULL</code> (the default),
no seeds are set during the training process.</p></dd>


<dt>attach_data</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, a copy of the training
data will be attached to the output. This is helpful if you
plan on using functions like <a href="orsf_pd_oob.html">orsf_pd_oob</a> or <a href="orsf_summarize_uni.html">orsf_summarize_uni</a>
to interpret the forest using its training data. Default is <code>TRUE</code>.</p></dd>


<dt>no_fit</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, model fitting steps are defined and
saved, but training is not initiated. The object returned can be
directly submitted to <code>orsf_train()</code> so long as <code>attach_data</code> is <code>TRUE</code>.</p></dd>


<dt>na_action</dt>
<dd><p>(<em>character</em>) what should happen when <code>data</code> contains missing values (i.e., <code>NA</code> values). Valid options are:</p><ul><li><p>'fail' : an error is thrown if <code>data</code> contains <code>NA</code> values</p></li>
<li><p>'omit' : rows in <code>data</code> with incomplete data will be dropped</p></li>
<li><p>'impute_meanmode' : missing values for continuous and categorical variables in <code>data</code> will be imputed using the mean and mode, respectively. Note that is this
option is selected and <code>attach_data</code> is <code>TRUE</code>, the data attached
to the output will be the imputed version of <code>data</code>.</p></li>
</ul></dd>


<dt>verbose_progress</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, progress messages are
printed in the console.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed to or from other methods (not currently used).</p></dd>


<dt>object</dt>
<dd><p>an untrained 'aorsf' object, created by setting
<code>no_fit = TRUE</code> in <code>orsf()</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an accelerated oblique RSF object (<code>aorsf</code>)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is based on and highly similar to the <code>ORSF</code> function
in the <code>obliqueRSF</code> R package. The primary difference is that this
function runs much faster. The speed increase is attributable to better
management of memory (i.e., no unnecessary copies of inputs) and using
a Newton Raphson scoring algorithm to identify linear combinations of
inputs rather than performing penalized regression using routines in
<code>glmnet</code>.The modified Newton Raphson scoring algorithm that this
function applies is an adaptation of the C++ routine developed by
Terry M. Therneau that fits Cox proportional hazards models
(see <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code> and more specifically <code><a href="https://rdrr.io/pkg/survival/man/agreg.fit.html" class="external-link">survival::coxph.fit()</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details-on-inputs">Details on inputs<a class="anchor" aria-label="anchor" href="#details-on-inputs"></a></h2>
    


<p><strong>formula</strong>:</p><ul><li><p>The response in <code>formula</code> can be a survival
object as returned by the <a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a> function,
but can also just be the time and status variables. I.e.,
<code>Surv(time, status) ~ .</code> works just like <code>time + status ~ .</code></p></li>
<li><p>A <code>.</code> symbol on the right hand side is short-hand for using all
variables in <code>data</code> (omitting those on the left hand side of
<code>formula</code>) as predictors.</p></li>
<li><p>The order of variables in the left hand side matters. i.e.,
writing <code>status + time ~ .</code> will make <code>orsf</code> assume your
<code>status</code> variable is actually the <code>time</code> variable.</p></li>
</ul><p><strong>mtry</strong>:</p>
<p>The <code>mtry</code> parameter may be temporarily reduced to ensure there
are at least 2 events per predictor variable. This occurs when using
<a href="orsf_control_cph.html">orsf_control_cph</a> because coefficients in the Newton Raphson scoring
algorithm may become unstable when the number of covariates is
greater than or equal to the number of events. This reduction does not
occur when using <a href="orsf_control_net.html">orsf_control_net</a>.</p>
<p><strong>oobag_fun</strong>:</p>
<p>If <code>oobag_fun</code> is specified, it will be used in to compute negation
importance or permutation importance, but it will not have any role
for ANOVA importance.</p>
    </div>
    <div class="section level2">
    <h2 id="what-is-an-oblique-decision-tree-">What is an oblique decision tree?<a class="anchor" aria-label="anchor" href="#what-is-an-oblique-decision-tree-"></a></h2>
    


<p>Decision trees are developed by splitting a set of training data into two
new subsets, with the goal of having more similarity within the new subsets
than between them. This splitting process is repeated on the resulting
subsets of data until a stopping criterion is met. When the new subsets of
data are formed based on a single predictor, the decision tree is said to
be axis-based because the splits of the data appear perpendicular to the
axis of the predictor. When linear combinations of variables are used
instead of a single variable, the tree is oblique because the splits of
the data are neither parallel nor at a right angle to the axis</p>
<p><em>Figure</em> : Decision trees for classification with axis-based splitting
(left) and oblique splitting (right). Cases are orange squares; controls
are purple circles. Both trees partition the predictor space defined by
variables X1 and X2, but the oblique splits do a better job of separating
the two classes.</p>
<p><img src="figures/tree_axis_v_oblique.png" width="95%"></p>
    </div>
    <div class="section level2">
    <h2 id="what-is-a-random-forest-">What is a random forest?<a class="anchor" aria-label="anchor" href="#what-is-a-random-forest-"></a></h2>
    


<p>Random forests are collections of de-correlated decision trees.
Predictions from each tree are aggregated to make an ensemble
prediction for the forest. For more details, see Breiman at el, 2001.</p>
    </div>
    <div class="section level2">
    <h2 id="training-out-of-bag-error-and-testing">Training, out-of-bag error, and testing<a class="anchor" aria-label="anchor" href="#training-out-of-bag-error-and-testing"></a></h2>
    


<p>In random forests, each tree is grown with a bootstrapped version of
the training set. Because bootstrap samples are selected with replacement,
each bootstrapped training set contains about two-thirds of instances in
the original training set. The 'out-of-bag' data are instances that are
<em>not</em> in the bootstrapped training set. Each tree in the random forest
can make predictions for its out-of-bag data, and the out-of-bag
predictions can be aggregated to make an ensemble out-of-bag prediction.
Since the out-of-bag data are not used to grow the tree, the accuracy of
the ensemble out-of-bag predictions approximate the generalization error
of the random forest. Generalization error refers to the error of a
random forest's predictions when it is applied to predict outcomes for
data that were not used to train it, i.e., testing data.</p>
    </div>
    <div class="section level2">
    <h2 id="missing-data">Missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a></h2>
    


<p>Data passed to aorsf functions are not allowed to have missing values.
A user should impute missing values using an R package with that purpose,
such as <code>recipes</code> or <code>mlr3pipelines</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
    <p>First we load some relevant packages</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329730</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/aorsf" class="external-link">aorsf</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.randomforestsrc.org/" class="external-link">randomForestSRC</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/imbs-hl/ranger" class="external-link">ranger</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tagteam/riskRegression" class="external-link">riskRegression</a></span><span class="op">)</span> </span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">obliqueRSF</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
<p>The entry-point into <code>aorsf</code> is the standard call to <code>orsf()</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span><span class="op">)</span></span></code></pre><p></p></div>
<p>printing <code>fit</code> provides quick descriptive summaries:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit</span></span>
<span><span class="co">#&gt; ---------- Oblique random survival forest</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Linear combinations: Accelerated</span></span>
<span><span class="co">#&gt;           N observations: 276</span></span>
<span><span class="co">#&gt;                 N events: 111</span></span>
<span><span class="co">#&gt;                  N trees: 500</span></span>
<span><span class="co">#&gt;       N predictors total: 17</span></span>
<span><span class="co">#&gt;    N predictors per node: 5</span></span>
<span><span class="co">#&gt;  Average leaves per tree: 24</span></span>
<span><span class="co">#&gt; Min observations in leaf: 5</span></span>
<span><span class="co">#&gt;       Min events in leaf: 1</span></span>
<span><span class="co">#&gt;           OOB stat value: 0.84</span></span>
<span><span class="co">#&gt;            OOB stat type: Harrell's C-statistic</span></span>
<span><span class="co">#&gt;      Variable importance: anova</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre><p></p></div><div class="section">
<h3 id="model-control">Model control<a class="anchor" aria-label="anchor" href="#model-control"></a></h3>


<p>For these examples we will make use of the <code>orsf_control_</code> functions to
build and compare models based on their out-of-bag predictions. We will
also standardize the out-of-bag samples using the input argument
<code>tree_seeds</code></p><div class="section">
<h4 id="accelerated-linear-combinations">Accelerated linear combinations<a class="anchor" aria-label="anchor" href="#accelerated-linear-combinations"></a></h4>


<p>The accelerated ORSF ensemble is the default because it has a nice
balance of computational speed and prediction accuracy. It runs a single
iteration of Newton Raphson scoring on the Cox partial likelihood
function to find linear combinations of predictors.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_accel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, </span>
<span>                  control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_fast.html">orsf_control_fast</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                  tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h4 id="linear-combinations-with-cox-regression">Linear combinations with Cox regression<a class="anchor" aria-label="anchor" href="#linear-combinations-with-cox-regression"></a></h4>


<p><code>orsf_control_cph</code> runs Cox regression in each non-terminal node of each
survival tree, using the regression coefficients to create linear
combinations of predictors:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, </span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_cph.html">orsf_control_cph</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h4 id="linear-combinations-with-penalized-cox-regression">Linear combinations with penalized cox regression<a class="anchor" aria-label="anchor" href="#linear-combinations-with-penalized-cox-regression"></a></h4>


<p><code>orsf_control_net</code> runs penalized Cox regression in each non-terminal
node of each survival tree, using the regression coefficients to create
linear combinations of predictors. This can be really helpful if you
want to do feature selection within the node, but it is a lot slower
than the other options.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, </span>
<span>                <span class="co"># select 3 predictors out of 5 to be used in</span></span>
<span>                <span class="co"># each linear combination of predictors.</span></span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_net.html">orsf_control_net</a></span><span class="op">(</span>df_target <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h4 id="linear-combinations-with-your-own-function">Linear combinations with your own function<a class="anchor" aria-label="anchor" href="#linear-combinations-with-your-own-function"></a></h4>


<p>Let’s make two customized functions to identify linear combinations of
predictors.</p><ul><li><p>The first uses random coefficients</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">f_rando</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_node</span>, <span class="va">y_node</span>, <span class="va">w_node</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_node</span><span class="op">)</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre><p></p></div></li>
<li><p>The second derives coefficients from principal component analysis.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">f_pca</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_node</span>, <span class="va">y_node</span>, <span class="va">w_node</span><span class="op">)</span> <span class="op">{</span> </span>
<span></span>
<span> <span class="co"># estimate two principal components.</span></span>
<span> <span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">x_node</span>, rank. <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span> <span class="co"># use the second principal component to split the node</span></span>
<span> <span class="va">pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">2L</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre><p></p></div></li>
</ul><p>We can plug these functions into <code><a href="orsf_control_custom.html">orsf_control_custom()</a></code>, and then pass
the result into <code>orsf()</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_rando</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                  control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_custom.html">orsf_control_custom</a></span><span class="op">(</span>beta_fun <span class="op">=</span> <span class="va">f_rando</span><span class="op">)</span>,</span>
<span>                  tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_custom.html">orsf_control_custom</a></span><span class="op">(</span>beta_fun <span class="op">=</span> <span class="va">f_pca</span><span class="op">)</span>,</span>
<span>                tree_seeds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span></span></code></pre><p></p></div>
<p>So which fit seems to work best in this example? Let’s find out by
evaluating the out-of-bag survival predictions.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">risk_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> accel <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit_accel</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> cph   <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit_cph</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> net   <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit_net</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> rando <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit_rando</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> pca   <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">fit_pca</span><span class="op">$</span><span class="va">pred_oobag</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/Score.html" class="external-link">Score</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">risk_preds</span>, </span>
<span>            formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>            data <span class="op">=</span> <span class="va">pbc_orsf</span>, </span>
<span>            summary <span class="op">=</span> <span class="st">'IPA'</span>,</span>
<span>            times <span class="op">=</span> <span class="va">fit_accel</span><span class="op">$</span><span class="va">pred_horizon</span><span class="op">)</span></span></code></pre><p></p></div>
<p>The AUC values, from highest to lowest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">sc</span><span class="op">$</span><span class="va">AUC</span><span class="op">$</span><span class="va">score</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">AUC</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;     model times       AUC         se     lower     upper</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt; &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  accel  1788 0.9106308 0.02180374 0.8678963 0.9533654</span></span>
<span><span class="co">#&gt; 2:    net  1788 0.9081592 0.02161885 0.8657871 0.9505314</span></span>
<span><span class="co">#&gt; 3:    cph  1788 0.9072690 0.02122339 0.8656719 0.9488660</span></span>
<span><span class="co">#&gt; 4:    pca  1788 0.8915619 0.02337586 0.8457461 0.9373778</span></span>
<span><span class="co">#&gt; 5:  rando  1788 0.8900944 0.02230125 0.8463847 0.9338040</span></span></code></pre><p></p></div>
<p>And the indices of prediction accuracy:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">sc</span><span class="op">$</span><span class="va">Brier</span><span class="op">$</span><span class="va">score</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">IPA</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">model</span>, <span class="va">times</span>, <span class="va">IPA</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;         model times       IPA</span></span>
<span><span class="co">#&gt;        &lt;fctr&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      accel  1788 0.4891448</span></span>
<span><span class="co">#&gt; 2:        net  1788 0.4842680</span></span>
<span><span class="co">#&gt; 3:        cph  1788 0.4687734</span></span>
<span><span class="co">#&gt; 4:      rando  1788 0.4011573</span></span>
<span><span class="co">#&gt; 5:        pca  1788 0.3845911</span></span>
<span><span class="co">#&gt; 6: Null model  1788 0.0000000</span></span></code></pre><p></p></div>
<p>From inspection,</p><ul><li><p>the PCA approach has the highest discrimination, showing that you
can do very well with just a two line custom function.</p></li>
<li><p>the accelerated ORSF has the highest index of prediction accuracy</p></li>
<li><p>the random coefficients generally don’t do that well.</p></li>
</ul></div>


</div>

<div class="section">
<h3 id="tidymodels">tidymodels<a class="anchor" aria-label="anchor" href="#tidymodels"></a></h3>


<p>This example uses <code>tidymodels</code> functions but stops short of using an
official <code>tidymodels</code> workflow. I am working on getting <code>aorsf</code> pulled
into the <code>censored</code> package and I will update this with real workflows
if that happens!</p><div class="section">
<h4 id="comparing-orsf-with-other-learners">Comparing ORSF with other learners<a class="anchor" aria-label="anchor" href="#comparing-orsf-with-other-learners"></a></h4>


<p>Start with a recipe to pre-process data</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">imputer</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">pbc_orsf</span>, formula <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">status</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span> <span class="fu">step_impute_mean</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">step_impute_mode</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre><p></p></div>
<p>Next create a 10-fold cross validation object and pre-process the data:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># 10-fold cross validation; make a container for the pre-processed data</span></span>
<span><span class="va">analyses</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf</span>, v <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">mutate</span><span class="op">(</span>recipe <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">splits</span>, <span class="op">~</span><span class="fu">prep</span><span class="op">(</span><span class="va">imputer</span>, training <span class="op">=</span> <span class="fu">training</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        train <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">recipe</span>, <span class="va">juice</span><span class="op">)</span>,</span>
<span>        test <span class="op">=</span> <span class="fu">map2</span><span class="op">(</span><span class="va">splits</span>, <span class="va">recipe</span>, <span class="op">~</span><span class="fu">bake</span><span class="op">(</span><span class="va">.y</span>, new_data <span class="op">=</span> <span class="fu">testing</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyses</span></span>
<span><span class="co">#&gt; #  10-fold cross-validation </span></span>
<span><span class="co">#&gt; # A tibble: 10 x 5</span></span>
<span><span class="co">#&gt;    splits           id     recipe   train               test              </span></span>
<span><span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;   &lt;list&gt;              &lt;list&gt;            </span></span>
<span><span class="co">#&gt;  1 &lt;split [248/28]&gt; Fold01 &lt;recipe&gt; &lt;tibble [248 x 20]&gt; &lt;tibble [28 x 20]&gt;</span></span>
<span><span class="co">#&gt;  2 &lt;split [248/28]&gt; Fold02 &lt;recipe&gt; &lt;tibble [248 x 20]&gt; &lt;tibble [28 x 20]&gt;</span></span>
<span><span class="co">#&gt;  3 &lt;split [248/28]&gt; Fold03 &lt;recipe&gt; &lt;tibble [248 x 20]&gt; &lt;tibble [28 x 20]&gt;</span></span>
<span><span class="co">#&gt;  4 &lt;split [248/28]&gt; Fold04 &lt;recipe&gt; &lt;tibble [248 x 20]&gt; &lt;tibble [28 x 20]&gt;</span></span>
<span><span class="co">#&gt;  5 &lt;split [248/28]&gt; Fold05 &lt;recipe&gt; &lt;tibble [248 x 20]&gt; &lt;tibble [28 x 20]&gt;</span></span>
<span><span class="co">#&gt;  6 &lt;split [248/28]&gt; Fold06 &lt;recipe&gt; &lt;tibble [248 x 20]&gt; &lt;tibble [28 x 20]&gt;</span></span>
<span><span class="co">#&gt;  7 &lt;split [249/27]&gt; Fold07 &lt;recipe&gt; &lt;tibble [249 x 20]&gt; &lt;tibble [27 x 20]&gt;</span></span>
<span><span class="co">#&gt;  8 &lt;split [249/27]&gt; Fold08 &lt;recipe&gt; &lt;tibble [249 x 20]&gt; &lt;tibble [27 x 20]&gt;</span></span>
<span><span class="co">#&gt;  9 &lt;split [249/27]&gt; Fold09 &lt;recipe&gt; &lt;tibble [249 x 20]&gt; &lt;tibble [27 x 20]&gt;</span></span>
<span><span class="co">#&gt; 10 &lt;split [249/27]&gt; Fold10 &lt;recipe&gt; &lt;tibble [249 x 20]&gt; &lt;tibble [27 x 20]&gt;</span></span></code></pre><p></p></div>
<p>Define functions for a ‘workflow’ with <code>randomForestSRC</code>, <code>ranger</code>, and
<code>aorsf</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">rfsrc_wf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span>, <span class="va">pred_horizon</span><span class="op">)</span><span class="op">{</span></span>
<span> </span>
<span> <span class="co"># rfsrc does not like tibbles, so cast input data into data.frames</span></span>
<span> <span class="va">train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span></span>
<span> <span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span>
<span> </span>
<span> <span class="fu"><a href="https://www.randomforestsrc.org//reference/rfsrc.html" class="external-link">rfsrc</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/predictRisk.html" class="external-link">predictRisk</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">test</span>, times <span class="op">=</span> <span class="va">pred_horizon</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ranger_wf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span>, <span class="va">pred_horizon</span><span class="op">)</span><span class="op">{</span></span>
<span> </span>
<span> <span class="fu"><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/predictRisk.html" class="external-link">predictRisk</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">test</span>, times <span class="op">=</span> <span class="va">pred_horizon</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aorsf_wf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span>, <span class="va">pred_horizon</span><span class="op">)</span><span class="op">{</span></span>
<span> </span>
<span> <span class="va">train</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>,<span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">test</span>, pred_horizon <span class="op">=</span> <span class="va">pred_horizon</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span> </span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p>Run the ‘workflows’ on each fold:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># 5 year risk prediction</span></span>
<span><span class="va">ph</span> <span class="op">&lt;-</span> <span class="fl">365.25</span> <span class="op">*</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">analyses</span> <span class="op">%&gt;%</span> </span>
<span> <span class="fu">transmute</span><span class="op">(</span><span class="va">test</span>, </span>
<span>           pred_aorsf <span class="op">=</span> <span class="fu">map2</span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span>, <span class="va">aorsf_wf</span>, pred_horizon <span class="op">=</span> <span class="va">ph</span><span class="op">)</span>,</span>
<span>           pred_rfsrc <span class="op">=</span> <span class="fu">map2</span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span>, <span class="va">rfsrc_wf</span>, pred_horizon <span class="op">=</span> <span class="va">ph</span><span class="op">)</span>,</span>
<span>           pred_ranger <span class="op">=</span> <span class="fu">map2</span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span>, <span class="va">ranger_wf</span>, pred_horizon <span class="op">=</span> <span class="va">ph</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Next unnest each column to get back a <code>tibble</code> with all of the testing
data and predictions.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span> </span>
<span> <span class="fu">unnest</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 276</span></span>
<span><span class="co">#&gt; Columns: 23</span></span>
<span><span class="co">#&gt; $ id          &lt;int&gt; 2, 16, 27, 66, 79, 97, 107, 116, 136, 137, 158, 189, 193,~</span></span>
<span><span class="co">#&gt; $ trt         &lt;fct&gt; d_penicill_main, placebo, placebo, d_penicill_main, d_pen~</span></span>
<span><span class="co">#&gt; $ age         &lt;dbl&gt; 56.44627, 40.44353, 54.43943, 46.45311, 46.51608, 71.8932~</span></span>
<span><span class="co">#&gt; $ sex         &lt;fct&gt; f, f, f, m, f, m, f, f, f, f, f, f, f, f, f, f, f, f, f, ~</span></span>
<span><span class="co">#&gt; $ ascites     &lt;fct&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~</span></span>
<span><span class="co">#&gt; $ hepato      &lt;fct&gt; 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, ~</span></span>
<span><span class="co">#&gt; $ spiders     &lt;fct&gt; 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, ~</span></span>
<span><span class="co">#&gt; $ edema       &lt;fct&gt; 0, 0, 0.5, 0, 0, 0.5, 0, 0.5, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~</span></span>
<span><span class="co">#&gt; $ bili        &lt;dbl&gt; 1.1, 0.7, 21.6, 1.4, 0.8, 2.0, 0.6, 3.0, 0.8, 1.1, 3.4, 1~</span></span>
<span><span class="co">#&gt; $ chol        &lt;int&gt; 302, 204, 175, 427, 315, 420, 212, 458, 263, 399, 450, 36~</span></span>
<span><span class="co">#&gt; $ albumin     &lt;dbl&gt; 4.14, 3.66, 3.31, 3.70, 4.24, 3.26, 4.03, 3.63, 3.35, 3.6~</span></span>
<span><span class="co">#&gt; $ copper      &lt;int&gt; 54, 28, 221, 105, 13, 62, 10, 74, 27, 79, 32, 52, 267, 76~</span></span>
<span><span class="co">#&gt; $ alk.phos    &lt;dbl&gt; 7394.8, 685.0, 3697.4, 1909.0, 1637.0, 3196.0, 648.0, 158~</span></span>
<span><span class="co">#&gt; $ ast         &lt;dbl&gt; 113.52, 72.85, 101.91, 182.90, 170.50, 77.50, 71.30, 106.~</span></span>
<span><span class="co">#&gt; $ trig        &lt;int&gt; 88, 58, 168, 171, 70, 91, 77, 382, 69, 152, 118, 164, 157~</span></span>
<span><span class="co">#&gt; $ platelet    &lt;int&gt; 221, 198, 80, 123, 426, 344, 316, 438, 206, 344, 313, 256~</span></span>
<span><span class="co">#&gt; $ protime     &lt;dbl&gt; 10.6, 10.8, 12.0, 11.0, 10.9, 11.4, 17.1, 9.9, 9.8, 10.1,~</span></span>
<span><span class="co">#&gt; $ stage       &lt;ord&gt; 3, 3, 4, 3, 3, 3, 1, 3, 2, 2, 2, 3, 4, 4, 2, 2, 3, 3, 4, ~</span></span>
<span><span class="co">#&gt; $ time        &lt;int&gt; 4500, 3672, 77, 4191, 3707, 611, 3388, 3336, 3098, 2990, ~</span></span>
<span><span class="co">#&gt; $ status      &lt;dbl&gt; 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, ~</span></span>
<span><span class="co">#&gt; $ pred_aorsf  &lt;dbl&gt; 0.21650571, 0.01569191, 0.93095617, 0.36737089, 0.1286820~</span></span>
<span><span class="co">#&gt; $ pred_rfsrc  &lt;dbl&gt; 0.15202784, 0.01104486, 0.81913559, 0.20173550, 0.1380660~</span></span>
<span><span class="co">#&gt; $ pred_ranger &lt;dbl&gt; 0.11418963, 0.02130315, 0.77073269, 0.22130305, 0.1841997~</span></span></code></pre><p></p></div>
<p>And finish by aggregating the predictions and computing performance in
the testing data. Note that I am computing one statistic for all
predictions instead of computing one statistic for each fold. This
approach is fine when you have smaller testing sets and/or small event
counts.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/Score.html" class="external-link">Score</a></span><span class="op">(</span></span>
<span> object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aorsf <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">pred_aorsf</span>,</span>
<span>               rfsrc <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">pred_rfsrc</span>,</span>
<span>               ranger <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">pred_ranger</span><span class="op">)</span>,</span>
<span> formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span> data <span class="op">=</span> <span class="va">results</span>, </span>
<span> summary <span class="op">=</span> <span class="st">'IPA'</span>,</span>
<span> times <span class="op">=</span> <span class="va">ph</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Metric AUC:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results by model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     model times    AUC  lower  upper</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt; &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:  aorsf  1826   90.1   85.7   94.6</span></span>
<span><span class="co">#&gt; 2:  rfsrc  1826   89.4   85.0   93.7</span></span>
<span><span class="co">#&gt; 3: ranger  1826   90.1   85.9   94.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results of model comparisons:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    times  model reference delta.AUC  lower  upper     p</span></span>
<span><span class="co">#&gt;    &lt;num&gt; &lt;fctr&gt;    &lt;fctr&gt;    &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  1826  rfsrc     aorsf      -0.7   -2.3    0.8   0.4</span></span>
<span><span class="co">#&gt; 2:  1826 ranger     aorsf      -0.0   -1.7    1.6   1.0</span></span>
<span><span class="co">#&gt; 3:  1826 ranger     rfsrc       0.7   -0.4    1.8   0.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; NOTE: Values are multiplied by 100 and given in %.</span></span>
<span><span class="co">#&gt; NOTE: The higher AUC the better.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Metric Brier:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results by model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         model   times  Brier  lower  upper    IPA</span></span>
<span><span class="co">#&gt;        &lt;fctr&gt;   &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: Null model 1826.25   20.5   18.1   22.9    0.0</span></span>
<span><span class="co">#&gt; 2:      aorsf 1826.25   11.1    8.8   13.4   45.8</span></span>
<span><span class="co">#&gt; 3:      rfsrc 1826.25   12.0    9.8   14.1   41.6</span></span>
<span><span class="co">#&gt; 4:     ranger 1826.25   11.8    9.7   13.9   42.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results of model comparisons:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      times  model  reference delta.Brier  lower  upper            p</span></span>
<span><span class="co">#&gt;      &lt;num&gt; &lt;fctr&gt;     &lt;fctr&gt;      &lt;char&gt; &lt;char&gt; &lt;char&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1826.25  aorsf Null model        -9.4  -12.1   -6.6 2.422069e-11</span></span>
<span><span class="co">#&gt; 2: 1826.25  rfsrc Null model        -8.5  -10.8   -6.2 2.101397e-13</span></span>
<span><span class="co">#&gt; 3: 1826.25 ranger Null model        -8.7  -11.0   -6.4 1.803141e-13</span></span>
<span><span class="co">#&gt; 4: 1826.25  rfsrc      aorsf         0.9   -0.0    1.7 5.278216e-02</span></span>
<span><span class="co">#&gt; 5: 1826.25 ranger      aorsf         0.7   -0.1    1.5 1.008860e-01</span></span>
<span><span class="co">#&gt; 6: 1826.25 ranger      rfsrc        -0.2   -0.7    0.3 4.551058e-01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; NOTE: Values are multiplied by 100 and given in %.</span></span>
<span><span class="co">#&gt; NOTE: The lower Brier the better, the higher IPA the better.</span></span></code></pre><p></p></div>
<p>From inspection,</p><ul><li><p><code>aorsf</code> obtained slightly higher discrimination (AUC)</p></li>
<li><p><code>aorsf</code> obtained higher index of prediction accuracy (IPA)</p></li>
<li><p>Way to go, <code>aorsf</code></p></li>
</ul></div>


</div>

<div class="section">
<h3 id="mlr-pipelines">mlr3 pipelines<a class="anchor" aria-label="anchor" href="#mlr-pipelines"></a></h3>


<p><strong>Warning</strong>: this code may or may not run depending on your current
version of <code>mlr3proba</code>. First we load some additional <code>mlr3</code> libraries.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3verse.mlr-org.com" class="external-link">mlr3verse</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mlr3proba</span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mlr3extralearners</span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3viz.mlr-org.com" class="external-link">mlr3viz</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3benchmark.mlr-org.com" class="external-link">mlr3benchmark</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Next we’ll define some tasks for our learners to engage with.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># Mayo Clinic Primary Biliary Cholangitis Data</span></span>
<span><span class="va">task_pbc</span> <span class="op">&lt;-</span> </span>
<span> <span class="va">TaskSurv</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'pbc'</span>,  </span>
<span>  backend <span class="op">=</span> <span class="fu">select</span><span class="op">(</span><span class="va">pbc_orsf</span>, <span class="op">-</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="fu">mutate</span><span class="op">(</span>stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">)</span>,  </span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>, </span>
<span>  event <span class="op">=</span> <span class="st">"status"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Veteran's Administration Lung Cancer Trial</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">veteran</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_veteran</span> <span class="op">&lt;-</span> </span>
<span> <span class="va">TaskSurv</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'veteran'</span>,  </span>
<span>  backend <span class="op">=</span> <span class="va">veteran</span>,  </span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>, </span>
<span>  event <span class="op">=</span> <span class="st">"status"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># NKI 70 gene signature</span></span>
<span><span class="va">data_nki</span> <span class="op">&lt;-</span> <span class="fu">OpenML</span><span class="fu">::</span><span class="fu">getOMLDataSet</span><span class="op">(</span>data.id <span class="op">=</span> <span class="fl">1228</span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_nki</span> <span class="op">&lt;-</span> </span>
<span> <span class="va">TaskSurv</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'nki'</span>,  </span>
<span>  backend <span class="op">=</span> <span class="va">data_nki</span><span class="op">$</span><span class="va">data</span>,  </span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>, </span>
<span>  event <span class="op">=</span> <span class="st">"event"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Gene Expression-Based Survival Prediction in Lung Adenocarcinoma</span></span>
<span><span class="va">data_lung</span> <span class="op">&lt;-</span> <span class="fu">OpenML</span><span class="fu">::</span><span class="fu">getOMLDataSet</span><span class="op">(</span>data.id <span class="op">=</span> <span class="fl">1245</span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_lung</span> <span class="op">&lt;-</span> </span>
<span> <span class="va">TaskSurv</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'nki'</span>,  </span>
<span>  backend <span class="op">=</span> <span class="va">data_lung</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="fu">mutate</span><span class="op">(</span>OS_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">OS_event</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,  </span>
<span>  time <span class="op">=</span> <span class="st">"OS_years"</span>, </span>
<span>  event <span class="op">=</span> <span class="st">"OS_event"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Chemotherapy for Stage B/C colon cancer</span></span>
<span><span class="co"># (there are two rows per person, one for death </span></span>
<span><span class="co">#  and the other for recurrence, hence the two tasks)</span></span>
<span></span>
<span><span class="va">task_colon_death</span> <span class="op">&lt;-</span></span>
<span> <span class="va">TaskSurv</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'colon_death'</span>,  </span>
<span>  backend <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/colon.html" class="external-link">colon</a></span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">etype</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="co"># drop id, redundant variables</span></span>
<span>   <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">id</span>, <span class="op">-</span><span class="va">study</span>, <span class="op">-</span><span class="va">node4</span>, <span class="op">-</span><span class="va">etype</span><span class="op">)</span>,</span>
<span>   <span class="fu">mutate</span><span class="op">(</span>OS_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">OS_event</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,  </span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>, </span>
<span>  event <span class="op">=</span> <span class="st">"status"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="va">task_colon_recur</span> <span class="op">&lt;-</span></span>
<span> <span class="va">TaskSurv</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">'colon_death'</span>,  </span>
<span>  backend <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/colon.html" class="external-link">colon</a></span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">etype</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="co"># drop id, redundant variables</span></span>
<span>   <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">id</span>, <span class="op">-</span><span class="va">study</span>, <span class="op">-</span><span class="va">node4</span>, <span class="op">-</span><span class="va">etype</span><span class="op">)</span>,</span>
<span>   <span class="fu">mutate</span><span class="op">(</span>OS_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">OS_event</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,  </span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>, </span>
<span>  event <span class="op">=</span> <span class="st">"status"</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># putting them all together</span></span>
<span><span class="va">tasks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">task_pbc</span>,</span>
<span>              <span class="va">task_veteran</span>,</span>
<span>              <span class="va">task_nki</span>,</span>
<span>              <span class="va">task_lung</span>,</span>
<span>              <span class="va">task_colon_death</span>,</span>
<span>              <span class="va">task_colon_recur</span>,</span>
<span>              <span class="co"># add a few more pre-made ones</span></span>
<span>              <span class="fu">tsk</span><span class="op">(</span><span class="st">"actg"</span><span class="op">)</span>,</span>
<span>              <span class="fu">tsk</span><span class="op">(</span><span class="st">'gbcs'</span><span class="op">)</span>,</span>
<span>              <span class="fu">tsk</span><span class="op">(</span><span class="st">'grace'</span><span class="op">)</span>,</span>
<span>              <span class="fu">tsk</span><span class="op">(</span><span class="st">"unemployment"</span><span class="op">)</span>,</span>
<span>              <span class="fu">tsk</span><span class="op">(</span><span class="st">"whas"</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Now we can make a benchmark designed to compare our three favorite
learners:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># Learners with default parameters</span></span>
<span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu">lrns</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"surv.ranger"</span>, <span class="st">"surv.rfsrc"</span>, <span class="st">"surv.aorsf"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Brier (Graf) score, c-index and training time as measures</span></span>
<span><span class="va">measures</span> <span class="op">&lt;-</span> <span class="fu">msrs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"surv.graf"</span>, <span class="st">"surv.cindex"</span>, <span class="st">"time_train"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Benchmark with 5-fold CV</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu">benchmark_grid</span><span class="op">(</span></span>
<span>  tasks <span class="op">=</span> <span class="va">tasks</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">learners</span>,</span>
<span>  resamplings <span class="op">=</span> <span class="fu">rsmps</span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">benchmark_result</span> <span class="op">&lt;-</span> <span class="fu">benchmark</span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bm_scores</span> <span class="op">&lt;-</span> <span class="va">benchmark_result</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measures</span>, predict_sets <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Let’s look at the overall results:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">bm_scores</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">select</span><span class="op">(</span><span class="va">task_id</span>, <span class="va">learner_id</span>, <span class="va">surv.graf</span>, <span class="va">surv.cindex</span>, <span class="va">time_train</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">group_by</span><span class="op">(</span><span class="va">learner_id</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">surv.graf</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span> <span class="fu">summarize</span><span class="op">(</span></span>
<span>  <span class="fu">across</span><span class="op">(</span></span>
<span>   .cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">surv.graf</span>, <span class="va">surv.cindex</span>, <span class="va">time_train</span><span class="op">)</span>,</span>
<span>   .fns <span class="op">=</span> <span class="va">mean</span>, </span>
<span>   na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span> <span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#&gt; # A tibble: 3 x 4</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#&gt;   learner_id  surv.graf surv.cindex time_train</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt; 1 surv.aorsf      0.151       0.729      0.345</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; 2 surv.ranger     0.167       0.706      2.54 </span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt; 3 surv.rfsrc      0.156       0.715      0.783</span></span></code></pre><p></p></div>
<p>From inspection,</p><ul><li><p><code>aorsf</code> appears to have a higher expected value for ‘surv.cindex’
(higher is better)</p></li>
<li><p><code>aorsf</code> appears to have a lower expected value for ‘surv.graf’
(lower is better)</p></li>
<li><p><code>aorsf</code> has the lowest training time.</p></li>
</ul><p>the lower training time for <code>aorsf</code> is likely due to the fact that there
are many unique event times in the benchmark tasks. <code>ranger</code> and <code>rfsrc</code>
create grids of time points based on each unique event time in each leaf
of each decision tree, whereas <code>aorsf</code> also uses a grid but restricts it
to the unique event times among observations in the current leaf.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Harrell FE, Califf RM, Pryor DB, Lee KL, Rosati RA. Evaluating the Yield of Medical Tests. <em>JAMA</em> 1982; 247(18):2543-2546. DOI: 10.1001/jama.1982.03320430047030</p>
<p>Breiman L. Random forests. <em>Machine learning</em> 2001 Oct; 45(1):5-32. DOI: 10.1023/A:1010933404324</p>
<p>Ishwaran H, Kogalur UB, Blackstone EH, Lauer MS. Random survival forests. <em>Annals of applied statistics</em> 2008 Sep; 2(3):841-60. DOI: 10.1214/08-AOAS169</p>
<p>Jaeger BC, Long DL, Long DM, Sims M, Szychowski JM, Min YI, Mcclure LA, Howard G, Simon N. Oblique random survival forests. <em>Annals of applied statistics</em> 2019 Sep; 13(3):1847-83. DOI: 10.1214/19-AOAS1261</p>
<p>Jaeger BC, Welden S, Lenoir K, Speiser JL, Segar MW, Pandey A, Pajewski NM. Accelerated and interpretable oblique random survival forests. <em>arXiv e-prints</em> 2022 Aug; arXiv-2208. URL: https://arxiv.org/abs/2208.01129</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

